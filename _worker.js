// <!--GAMFC-->version base on commit: 1dd06b6fb65225fa78700440daba5354ce6b4888 - last update: 2025-12-21 17:45:23 UTC <!--GAMFC-END-->.

import{connect}from'cloudflare:sockets';const Config={'userID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':['cdn.xn--b6gac.eu.org','cdn-all.xn--b6gac.eu.org','edgetunnel.anycast.eu.org'],'scamalytics':{'username':'victoriacrossn','apiKey':'ed89b4fef21aba43c15cdd15cff2138dd8d3bbde5aaaa4690ad8e94990448516','baseUrl':'https://api12.scamalytics.com/v3/'},'dohURL':'https://cloudflare-dns.com/dns-query',async 'fromEnv'(a){let b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])];const [c,d='443']=b['split'](':');return{'userID':a['UUID']||this['userID'],'proxyIP':c,'proxyPort':parseInt(d,0xa),'proxyAddress':b,'scamalytics':{'username':a['SCAMALYTICS_USERNAME']||this['scamalytics']['username'],'apiKey':a['SCAMALYTICS_API_KEY']||this['scamalytics']['apiKey'],'baseUrl':a['SCAMALYTICS_BASEURL']||this['scamalytics']['baseUrl']},'landingPage':a['LANDING_PAGE']||'https://www.google.com','adminPath':a['ADMIN_PATH']||'admin'};}},CONST={'WS_READY_STATE_OPEN':0x1,'WS_READY_STATE_CLOSING':0x2,'UUID_REGEX':/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i,'HEALTH_CHECK_TIMEOUT':0x1388},Utils={'uuid':()=>crypto['randomUUID'](),'isValidUUID':a=>CONST['UUID_REGEX']['test'](a),'safeBase64':a=>{try{return btoa(unescape(encodeURIComponent(a)));}catch(b){return btoa(a);}},'base64ToArrayBuffer':a=>{if(!a)return{'earlyData':null,'error':null};try{a=a['replace'](/-/g,'+')['replace'](/_/g,'/');const b=atob(a),c=Uint8Array['from'](b,d=>d['charCodeAt'](0x0));return{'earlyData':c['buffer'],'error':null};}catch(d){return{'earlyData':null,'error':d};}},'formatBytes':a=>{if(a===0x0)return'0\x20B';const b=0x400,c=['B','KB','MB','GB','TB'],d=Math['floor'](Math['log'](a)/Math['log'](b));return parseFloat((a/Math['pow'](b,d))['toFixed'](0x2))+'\x20'+c[d];},'generateNonce':()=>{const a=new Uint8Array(0x10);return crypto['getRandomValues'](a),btoa(String['fromCharCode']['apply'](null,a));},'addSecurityHeaders':(a,b)=>{a['set']('Strict-Transport-Security','max-age=31536000;\x20includeSubDomains;\x20preload'),a['set']('X-Content-Type-Options','nosniff'),a['set']('X-Frame-Options','SAMEORIGIN'),a['set']('Referrer-Policy','strict-origin-when-cross-origin'),a['set']('Cache-Control','no-store,\x20max-age=0'),a['set']('Alt-Svc','h3=\x22:443\x22;\x20ma=86400'),b&&a['set']('Content-Security-Policy','default-src\x20\x27self\x27;\x20script-src\x20\x27self\x27\x20\x27nonce-'+b+'\x27\x20\x27unsafe-inline\x27\x20https://cdnjs.cloudflare.com;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20https://cdnjs.cloudflare.com;\x20img-src\x20\x27self\x27\x20data:\x20https:;\x20connect-src\x20\x27self\x27\x20https:\x20wss:;\x20font-src\x20\x27self\x27\x20https:\x20data:;');}},DB={async 'init'(a){if(!a['DB'])return;try{await a['DB']['batch']([a['DB']['prepare']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20email\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20traffic_used\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiry_date\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ip_limit\x20INTEGER\x20DEFAULT\x20-1,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20INTEGER\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)'),a['DB']['prepare']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20user_ips\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ip\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20last_seen\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20PRIMARY\x20KEY\x20(uuid,\x20ip)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)'),a['DB']['prepare']('CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20system_stats\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)')]);}catch(b){console['error']('DB\x20Init\x20Error:',b);}},async 'getUser'(a,b){if(!a['DB']){if(b===(a['UUID']||Config['userID']))return{'uuid':b,'email':'Admin\x20(Env)','traffic_used':0x0,'traffic_limit':0x0,'ip_limit':-0x1,'expiry_date':null};return null;}try{return await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();}catch(c){return null;}},async 'addTraffic'(a,b,c){if(!a['DB']||!b)return;try{await a['DB']['prepare']('UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](c,b)['run']();}catch(d){}},async 'logIP'(a,b,c){if(!a['DB']||!b)return;try{await a['DB']['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20user_ips\x20(uuid,\x20ip,\x20last_seen)\x20VALUES\x20(?,\x20?,\x20?)')['bind'](b,c,Date['now']())['run']();}catch(d){}}};async function vlessOverWSHandler(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();let g='',h='';const i=(m,n)=>console['log']('['+g+':'+h+']\x20'+m,n||''),j=a['headers']['get']('sec-websocket-protocol')||'',k=makeReadableWebSocketStream(f,j,i);let l={'uuid':null,'remoteSocket':null,'isConnected':![]};return k['pipeTo'](new WritableStream({async 'write'(m,n){if(l['isConnected']){if(l['remoteSocket']){const q=l['remoteSocket']['writable']['getWriter']();await q['write'](m),q['releaseLock']();if(l['uuid'])DB['addTraffic'](c,l['uuid'],m['byteLength']);}return;}const o=await processVlessHeader(m);if(o['hasError']){n['error']('VLESS\x20Error:\x20'+o['message']);return;}const p=await DB['getUser'](c,o['uuid']);if(!p){n['error']('Invalid\x20User');return;}if(p['expiry_date']&&new Date(p['expiry_date'])<new Date()){n['error']('Expired\x20User');return;}if(p['traffic_limit']>0x0&&p['traffic_used']>=p['traffic_limit']){n['error']('Traffic\x20Limit\x20Exceeded');return;}l['uuid']=o['uuid'],g=o['addressRemote'],h=o['portRemote']+'\x20('+(o['isUDP']?'UDP':'TCP')+')';try{l['remoteSocket']=await handleRemoteConnection(o['addressRemote'],o['portRemote'],o['isUDP']),l['isConnected']=!![];const r=l['remoteSocket']['writable']['getWriter']();await r['write'](m['slice'](o['rawDataIndex'])),r['releaseLock'](),f['send'](new Uint8Array([o['vlessVersion'][0x0],0x0])),streamRemoteToWS(l['remoteSocket'],f,l['uuid'],c);const s=a['headers']['get']('CF-Connecting-IP');DB['logIP'](c,l['uuid'],s);}catch(t){console['error']('Connect\x20failed\x20to\x20'+g+':'+h,t),n['error']('Connect\x20failed');}},'close'(){i('WS\x20Closed');},'abort'(m){i('WS\x20Aborted',m);}}))['catch'](m=>i('Stream\x20Error',m)),new Response(null,{'status':0x65,'webSocket':e});}function makeReadableWebSocketStream(a,b,c){return new ReadableStream({'start'(d){a['addEventListener']('message',g=>d['enqueue'](g['data'])),a['addEventListener']('close',()=>{safeCloseWS(a),d['close']();}),a['addEventListener']('error',g=>{c('WS\x20Error'),d['error'](g);});const {earlyData:e,error:f}=Utils['base64ToArrayBuffer'](b);if(f)d['error'](f);else{if(e)d['enqueue'](e);}},'cancel'(){safeCloseWS(a);}});}async function processVlessHeader(a){if(a['byteLength']<0x18)return{'hasError':!![],'message':'Invalid\x20data\x20length'};const b=new Uint8Array(a['slice'](0x0,0x1)),c=Utils['uuid']()['replace'](/-/g,''),d=new Uint8Array(a['slice'](0x1,0x11)),e=[...d['subarray'](0x0,0x4),...d['subarray'](0x4,0x6),...d['subarray'](0x6,0x8),...d['subarray'](0x8,0xa),...d['subarray'](0xa,0x10)]['map']((p,q)=>{const r=p['toString'](0x10)['padStart'](0x2,'0');return([0x3,0x5,0x7,0x9]['includes'](q)?'-':'')+r;})['join']('')['replace'](/-/g,'')['replace'](/(.{8})(.{4})(.{4})(.{4})(.{12})/,'$1-$2-$3-$4-$5'),f=new Uint8Array(a['slice'](0x11,0x12))[0x0],g=new Uint8Array(a['slice'](0x12+f,0x12+f+0x1))[0x0],h=g===0x2,i=0x12+f+0x1,j=new DataView(a['slice'](i,i+0x2))['getUint16'](0x0),k=i+0x2,l=new Uint8Array(a['slice'](k,k+0x1))[0x0];let m=0x0,n=k+0x1,o='';if(l===0x1)m=0x4,o=new Uint8Array(a['slice'](n,n+m))['join']('.');else{if(l===0x2)m=new Uint8Array(a['slice'](n,n+0x1))[0x0],n++,o=new TextDecoder()['decode'](a['slice'](n,n+m));else{if(l===0x3){m=0x10;const p=new Uint16Array(a['slice'](n,n+m));o='['+Array['from'](p)['map'](q=>q['toString'](0x10))['join'](':')+']';}else return{'hasError':!![],'message':'Unknown\x20address\x20type:\x20'+l};}}return{'hasError':![],'uuid':e,'portRemote':j,'addressRemote':o,'isUDP':h,'vlessVersion':b,'rawDataIndex':n+m};}async function handleRemoteConnection(a,b,c){if(c&&b!==0x35){}return connect({'hostname':a,'port':b});}async function streamRemoteToWS(a,b,c,d){await a['readable']['pipeTo'](new WritableStream({async 'write'(e){b['readyState']===CONST['WS_READY_STATE_OPEN']&&(b['send'](e),DB['addTraffic'](d,c,e['byteLength']));},'close'(){safeCloseWS(b);}}))['catch'](()=>safeCloseWS(b));}function safeCloseWS(a){try{if(a['readyState']===0x1||a['readyState']===0x2)a['close']();}catch(b){}}const UI_CSS='\x0a\x20\x20\x20\x20:root{--bg:#0f172a;--surface:#1e293b;--primary:#3b82f6;--text:#f8fafc;--text-dim:#94a3b8;--border:#334155;--success:#22c55e;--danger:#ef4444;}\x0a\x20\x20\x20\x20*{box-sizing:border-box;margin:0;padding:0;font-family:\x27Segoe\x20UI\x27,system-ui,sans-serif}\x0a\x20\x20\x20\x20body{background:var(--bg);color:var(--text);min-height:100vh;display:flex;flex-direction:column}\x0a\x20\x20\x20\x20.glass{background:rgba(30,41,59,0.7);backdrop-filter:blur(10px);border-bottom:1px\x20solid\x20var(--border)}\x0a\x20\x20\x20\x20.container{max-width:1200px;margin:0\x20auto;padding:20px;width:100%}\x0a\x20\x20\x20\x20.btn{background:var(--primary);color:#fff;border:none;padding:10px\x2020px;border-radius:8px;cursor:pointer;font-weight:600;display:inline-flex;align-items:center;gap:8px;transition:0.2s;text-decoration:none}\x0a\x20\x20\x20\x20.btn:hover{filter:brightness(1.1);transform:translateY(-1px)}\x0a\x20\x20\x20\x20.btn-outline{background:transparent;border:1px\x20solid\x20var(--border);color:var(--text-dim)}\x0a\x20\x20\x20\x20.btn-outline:hover{border-color:var(--primary);color:var(--primary)}\x0a\x20\x20\x20\x20.btn-danger{background:rgba(239,68,68,0.2);color:var(--danger);border:1px\x20solid\x20rgba(239,68,68,0.3)}\x0a\x20\x20\x20\x20.card{background:var(--surface);border-radius:16px;padding:24px;border:1px\x20solid\x20var(--border);margin-bottom:20px;box-shadow:0\x2010px\x2015px\x20-3px\x20rgba(0,0,0,0.1)}\x0a\x20\x20\x20\x20.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}\x0a\x20\x20\x20\x20input,select{background:var(--bg);border:1px\x20solid\x20var(--border);color:#fff;padding:12px;border-radius:8px;width:100%;outline:none;margin-bottom:10px}\x0a\x20\x20\x20\x20input:focus{border-color:var(--primary)}\x0a\x20\x20\x20\x20table{width:100%;border-collapse:collapse;margin-top:10px}\x0a\x20\x20\x20\x20th,td{padding:14px;text-align:left;border-bottom:1px\x20solid\x20var(--border)}\x0a\x20\x20\x20\x20th{color:var(--text-dim);font-size:12px;text-transform:uppercase;letter-spacing:1px}\x0a\x20\x20\x20\x20/*\x20Modal\x20*/\x0a\x20\x20\x20\x20.modal-overlay{position:fixed;inset:0;background:rgba(0,0,0,0.8);display:flex;justify-content:center;align-items:center;opacity:0;pointer-events:none;transition:0.3s;z-index:100}\x0a\x20\x20\x20\x20.modal-overlay.active{opacity:1;pointer-events:all}\x0a\x20\x20\x20\x20.modal{background:var(--surface);padding:30px;border-radius:16px;width:90%;max-width:450px;transform:scale(0.9);transition:0.3s;border:1px\x20solid\x20var(--border);text-align:center}\x0a\x20\x20\x20\x20.modal-overlay.active\x20.modal{transform:scale(1)}\x0a\x20\x20\x20\x20.close-modal{position:absolute;top:15px;right:15px;background:none;border:none;color:var(--text-dim);font-size:24px;cursor:pointer}\x0a\x20\x20\x20\x20#qrCanvas{margin:20px\x20auto;border:4px\x20solid\x20#fff;border-radius:8px;display:block}\x0a\x20\x20\x20\x20.badge{padding:4px\x208px;border-radius:4px;font-size:11px;font-weight:700}\x0a\x20\x20\x20\x20.badge-active{background:rgba(34,197,94,0.2);color:var(--success)}\x0a\x20\x20\x20\x20.stat-val{font-size:2rem;font-weight:800;color:var(--primary)}\x0a\x20\x20\x20\x20.stat-label{color:var(--text-dim);font-size:0.9rem}\x0a\x20\x20\x20\x20@media(max-width:768px){.hide-mobile{display:none}.grid{grid-template-columns:1fr}}\x0a',UI_SCRIPTS='\x0a\x20\x20\x20\x20<!--\x20Embedded\x20QR\x20Code\x20Generator\x20Logic\x20to\x20Avoid\x20External\x20API\x20Errors\x20-->\x0a\x20\x20\x20\x20<script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22\x20integrity=\x22sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==\x22\x20crossorigin=\x22anonymous\x22\x20referrerpolicy=\x22no-referrer\x22></script>\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20Copy\x20to\x20Clipboard\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20copyToClipboard(text)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20navigator.clipboard.writeText(text);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x22‚úì\x20Copied\x20to\x20clipboard!\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Fallback\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20ta\x20=\x20document.createElement(\x27textarea\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ta.value\x20=\x20text;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.body.appendChild(ta);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ta.select();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.execCommand(\x27copy\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.body.removeChild(ta);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x22‚úì\x20Copied\x20(Fallback)\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20Toast\x20Notification\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(msg,\x20isError)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20t\x20=\x20document.createElement(\x27div\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.style.cssText\x20=\x20`position:fixed;bottom:20px;right:20px;background:${isError?\x27#ef4444\x27:\x27#3b82f6\x27};color:#fff;padding:12px\x2024px;border-radius:8px;box-shadow:0\x204px\x2012px\x20rgba(0,0,0,0.3);z-index:9999;font-weight:600;animation:slideIn\x200.3s`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20t.innerText\x20=\x20msg;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.body.appendChild(t);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20t.style.opacity=\x270\x27;\x20setTimeout(()=>t.remove(),300);\x20},\x203000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20Modal\x20Logic\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20toggleModal(id,\x20show)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20el\x20=\x20document.getElementById(id);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(show)\x20el.classList.add(\x27active\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20el.classList.remove(\x27active\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20//\x20Smart\x20QR\x20Generator\x20(Client\x20Side)\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20generateQR(text,\x20title)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20container\x20=\x20document.getElementById(\x27qrContainer\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20container.innerHTML\x20=\x20\x22\x22;\x20//\x20Clear\x20previous\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(!text)\x20{\x20showToast(\x22Empty\x20Data\x20for\x20QR\x22,\x20true);\x20return;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27qrTitle\x27).innerText\x20=\x20title\x20||\x20\x22Scan\x20Code\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20new\x20QRCode(container,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text:\x20text,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20250,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20250,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorDark\x20:\x20\x22#000000\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorLight\x20:\x20\x22#ffffff\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20correctLevel\x20:\x20QRCode.CorrectLevel.M\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Add\x20Download\x20Button\x20dynamically\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20img\x20=\x20container.querySelector(\x27img\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(img\x20&&\x20img.src)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20btn\x20=\x20document.getElementById(\x27dlQrBtn\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.onclick\x20=\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20a\x20=\x20document.createElement(\x27a\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.href\x20=\x20img.src;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.download\x20=\x20\x27vless-qr.png\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20a.click();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.style.display\x20=\x20\x27inline-flex\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20},\x20500);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toggleModal(\x27qrModal\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20console.error(e);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x22QR\x20Generation\x20Failed\x22,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</script>\x0a';function renderUserPanel(a,b){const c='vless://'+a['uuid']+'@'+b+':443?encryption=none&security=tls&sni='+b+'&fp=chrome&type=ws&host='+b+'&path=%2F#'+encodeURIComponent(b),d='https://'+b+'/sub/'+a['uuid']+'?format=clash';return'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>User\x20Dashboard</title>\x0a\x20\x20\x20\x20<style>'+UI_CSS+'</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22glass\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22\x20style=\x22display:flex;justify-content:space-between;align-items:center\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20style=\x22background:linear-gradient(to\x20right,#3b82f6,#8b5cf6);-webkit-background-clip:text;color:transparent\x22>‚ö°\x20VLESS\x20Panel</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22badge\x20badge-active\x22>Active</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>üìä\x20Traffic\x20Usage</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22margin-top:15px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-val\x22>'+Utils['formatBytes'](a['traffic_used'])+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Total\x20Data\x20Consumed</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22background:var(--border);height:6px;border-radius:3px;margin-top:10px;overflow:hidden\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22width:'+(a['traffic_limit']>0x0?Math['min'](a['traffic_used']/a['traffic_limit']*0x64,0x64):0x1)+'%;background:var(--primary);height:100%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:var(--text-dim);margin-top:5px;display:block\x22>Limit:\x20'+(a['traffic_limit']?Utils['formatBytes'](a['traffic_limit']):'Unlimited')+'</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>üîó\x20Subscription</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20style=\x22color:var(--text-dim);font-size:0.9rem;margin:10px\x200\x2020px\x22>Import\x20your\x20configuration\x20securely.</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;gap:10px;flex-wrap:wrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22copyToClipboard(\x27'+c+'\x27)\x22>üìã\x20Copy\x20VLESS</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-outline\x22\x20onclick=\x22generateQR(\x27'+c+'\x27,\x20\x27VLESS\x20Config\x27)\x22>üì±\x20QR\x20Code</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<!--\x20QR\x20Modal\x20-->\x0a\x20\x20\x20\x20<div\x20id=\x22qrModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22close-modal\x22\x20onclick=\x22toggleModal(\x27qrModal\x27,false)\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20id=\x22qrTitle\x22\x20style=\x22margin-bottom:20px\x22>Scan\x20Code</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22qrContainer\x22\x20style=\x22display:flex;justify-content:center;margin-bottom:20px;padding:10px;background:#fff;border-radius:10px\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20id=\x22dlQrBtn\x22\x20class=\x22btn\x20btn-outline\x22\x20style=\x22display:none;width:100%;justify-content:center\x22>‚¨á\x20Download\x20QR\x20Image</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20'+UI_SCRIPTS+'\x0a</body>\x0a</html>';}async function renderAdminPanel(a,b){let c=[];try{if(a['DB']){const f=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();c=f['results']||[];}else c['push']({'uuid':a['UUID']||Config['userID'],'email':'System\x20(Env)','traffic_used':0x0});}catch(g){}const d=c['map'](h=>'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><code\x20style=\x22background:rgba(0,0,0,0.3);padding:4px;border-radius:4px\x22>'+h['uuid']+'</code></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22hide-mobile\x22>'+(h['email']||'-')+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>'+Utils['formatBytes'](h['traffic_used']||0x0)+'</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;gap:5px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-outline\x22\x20style=\x22padding:5px\x2010px;font-size:12px\x22\x20onclick=\x22window.open(\x27/'+h['uuid']+'\x27,\x27_blank\x27)\x22>View</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x22\x20style=\x22padding:5px\x2010px;font-size:12px\x22\x20onclick=\x22deleteUser(\x27'+h['uuid']+'\x27)\x22>Del</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20')['join']('');return'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Console</title>\x0a\x20\x20\x20\x20<style>'+UI_CSS+'</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22glass\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x22\x20style=\x22display:flex;justify-content:space-between;align-items:center\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20style=\x22color:var(--primary)\x22>üõ°Ô∏è\x20Admin\x20Console</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x22\x20onclick=\x22toggleModal(\x27addUserModal\x27,true)\x22>+\x20Add\x20User</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x22\x20style=\x22margin-bottom:20px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Total\x20Users</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-val\x22>'+c['length']+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>System\x20Health</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-val\x22\x20style=\x22color:var(--success);font-size:1.5rem\x22>Good</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>üë•\x20User\x20Management</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22overflow-x:auto\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>UUID</th><th\x20class=\x22hide-mobile\x22>Note</th><th>Traffic</th><th>Actions</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody>'+d+'</tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<!--\x20Add\x20User\x20Modal\x20-->\x0a\x20\x20\x20\x20<div\x20id=\x22addUserModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22close-modal\x22\x20onclick=\x22toggleModal(\x27addUserModal\x27,false)\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>Create\x20New\x20User</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20onsubmit=\x22handleCreateUser(event)\x22\x20style=\x22margin-top:20px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20name=\x22email\x22\x20placeholder=\x22Email\x20/\x20Note\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20name=\x22limit\x22\x20placeholder=\x22Traffic\x20Limit\x20(GB)\x20-\x200\x20for\x20unlimited\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20name=\x22expiry\x22\x20placeholder=\x22Expiry\x20Date\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x22\x20style=\x22width:100%;justify-content:center;margin-top:10px\x22>Create\x20User</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20'+UI_SCRIPTS+'\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleCreateUser(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20form\x20=\x20e.target;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20data\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20email:\x20form.email.value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20limit:\x20form.limit.value\x20?\x20parseInt(form.limit.value)\x20*\x201024\x20*\x201024\x20*\x201024\x20:\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiry:\x20form.expiry.value\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20res\x20=\x20await\x20fetch(\x27/api/users\x27,\x20{\x20method:\x27POST\x27,\x20headers:{\x27Content-Type\x27:\x27application/json\x27},\x20body:JSON.stringify(data)\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(res.ok)\x20location.reload();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20showToast(\x22Creation\x20Failed\x22,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{\x20showToast(\x22Error\x22,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20deleteUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(!confirm(\x22Delete\x20this\x20user?\x22))\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetch(\x27/api/users?uuid=\x27+uuid,\x20{\x20method:\x27DELETE\x27\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20location.reload();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{\x20showToast(\x22Error\x20deleting\x22,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>';}export default{async 'fetch'(a,b,c){const d=new URL(a['url']),f=await Config['fromEnv'](b),g=Utils['generateNonce']();await DB['init'](b);if(a['headers']['get']('Upgrade')==='websocket')return await vlessOverWSHandler(a,f,b);const h=d['pathname'];if(h==='/robots.txt')return new Response('User-agent:\x20*\x0aDisallow:\x20/',{'status':0xc8});if(h==='/security.txt')return new Response('Contact:\x20'+f['adminPath']+'@'+d['hostname']+'\x0aEncryption:\x20https://'+d['hostname'],{'status':0xc8});if(h['startsWith']('/api/users')){if(a['method']==='POST'){const j=await a['json'](),k=Utils['uuid']();return b['DB']&&await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20email,\x20traffic_limit,\x20expiry_date,\x20created_at)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)')['bind'](k,j['email'],j['limit'],j['expiry'],Date['now']())['run'](),new Response(JSON['stringify']({'uuid':k}),{'status':0xc8});}if(a['method']==='DELETE'){const l=d['searchParams']['get']('uuid');if(b['DB'])await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](l)['run']();return new Response('Deleted',{'status':0xc8});}}if(h==='/'+f['adminPath']||h==='/'+f['userID']){const m=await renderAdminPanel(b,d['hostname']),n=new Headers({'Content-Type':'text/html'});return Utils['addSecurityHeaders'](n,g),new Response(m['replace'](/NONCE_PLACEHOLDER/g,g),{'headers':n});}const i=h['replace']('/','');if(Utils['isValidUUID'](i)){const o=await DB['getUser'](b,i);if(o){const p=renderUserPanel(o,d['hostname']),q=new Headers({'Content-Type':'text/html'});return Utils['addSecurityHeaders'](q,g),new Response(p,{'headers':q});}}try{const r=new URL(f['landingPage']),s=new Request(r['origin']+h+d['search'],a);s['headers']['set']('Host',r['hostname']),s['headers']['set']('Referer',r['origin']),s['headers']['set']('User-Agent',a['headers']['get']('User-Agent'));const t=await fetch(s),u=new Headers(t['headers']);return Utils['addSecurityHeaders'](u,null),new Response(t['body'],{'status':t['status'],'statusText':t['statusText'],'headers':u});}catch(v){return new Response('404\x20Not\x20Found',{'status':0x194});}},async 'scheduled'(a,b,c){if(b['DB']){const d=Date['now']()-0x1e*0x18*0x3c*0x3c*0x3e8;await b['DB']['prepare']('DELETE\x20FROM\x20user_ips\x20WHERE\x20last_seen\x20<\x20?')['bind'](d)['run']();}}};