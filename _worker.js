// <!--GAMFC-->version base on commit: 1ec78da74f60dd3369fe5bb3e66286b409a31b15 - last update: 2025-12-25 22:51:31 UTC <!--GAMFC-END-->.

import{connect}from'cloudflare:sockets';const CONFIG={'VERSION':'10.0.0-ULTIMATE','PATHS':{'API':'/api/v3','VLESS':'/vless','PANEL':'/panel','HEALTH':'/health','LOGIN':'/admin-login'},'SECURITY':{'RATE_LIMIT':0x64,'MAX_CONNECTIONS':0xa,'SESSION_TIMEOUT':0x5265c00,'TOKEN_LENGTH':0x20,'DEFAULT_SCAMALYTICS_THRESHOLD':0x4b},'QUANTUM':{'FRAGMENTATION':!![],'PADDING':!![],'MIN_FRAGMENT':0x80,'MAX_FRAGMENT':0x578},'DEFAULT_PROXY_TARGETS':['https://www.cloudflare.com','https://www.mozilla.org','https://www.ietf.org','https://www.w3.org']},rateMap=new Map(),cacheMap=new Map();export default{async 'fetch'(a,b,c){try{const d=new URL(a['url']),e=a['headers']['get']('CF-Connecting-IP')||'unknown',f=d['pathname'],g=b['ADMIN_PATH_PREFIX']||'/quantum-admin';if(a['method']==='OPTIONS')return new Response(null,{'status':0xcc,'headers':getCorsHeaders()});if(!checkRateLimit(e))return createJsonResponse({'error':'Too\x20many\x20requests','retryAfter':0x3c},0x1ad);if(b['SCAMALYTICS_THRESHOLD']){const h=await checkSuspiciousIP(e,parseInt(b['SCAMALYTICS_THRESHOLD'])||CONFIG['SECURITY']['DEFAULT_SCAMALYTICS_THRESHOLD'],b);if(h)return console['warn']('[Security]\x20Blocked\x20suspicious\x20IP:\x20'+e),handleFakePage(b);}if(f==='/'||f==='')return handleSmartReverseProxy(a,b);if(f===CONFIG['PATHS']['HEALTH'])return handleHealthCheck(b,g);if(f['startsWith'](CONFIG['PATHS']['PANEL']+'/'))return handleUserPanel(d,b);if(f===CONFIG['PATHS']['VLESS']){const i=a['headers']['get']('Upgrade');if(i&&i['toLowerCase']()==='websocket')return handleVLESSConnection(a,b,c,e);}if(f['startsWith'](CONFIG['PATHS']['API']))return handleAPIRequest(a,b,e);if(f===g)return handleAdminPanel(b,g);if(f===g+'/login'&&a['method']==='POST')return handleAdminLogin(a,b,e);return handleFakePage(b);}catch(j){return console['error']('[Worker]\x20Critical\x20Error:',j),createJsonResponse({'error':'Internal\x20server\x20error','message':j instanceof Error?j['message']:'Unknown\x20error'},0x1f4);}}};async function handleSmartReverseProxy(a,b){try{let c=b['ROOT_PROXY_URL'];(!c||!isValidURL(c))&&(console['warn']('[Proxy]\x20ROOT_PROXY_URL\x20invalid,\x20using\x20fallback'),c=CONFIG['DEFAULT_PROXY_TARGETS'][0x0]);try{const d=await fetch(c,{'method':a['method'],'headers':{'User-Agent':a['headers']['get']('User-Agent')||'Mozilla/5.0\x20(Windows\x20NT\x2010.0;\x20Win64;\x20x64)\x20AppleWebKit/537.36','Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8','Accept-Language':'en-US,en;q=0.9'},'redirect':'follow'});if(d['ok']){const e=new Headers(d['headers']);return e['set']('X-Proxied-By','Quantum-Shield'),e['delete']('Content-Security-Policy'),e['delete']('X-Frame-Options'),new Response(d['body'],{'status':d['status'],'headers':e});}}catch(f){console['error']('[Proxy]\x20Failed\x20to\x20fetch\x20target:',f);}return handleFakePage(b);}catch(g){return console['error']('[Proxy]\x20Error:',g),handleFakePage(b);}}async function checkSuspiciousIP(a,b,c){try{if(isPrivateIP(a))return![];const d='scam_'+a,e=cacheMap['get'](d);if(e&&Date['now']()-e['timestamp']<0x36ee80)return e['value'];const f=![];return cacheMap['set'](d,{'value':f,'timestamp':Date['now']()}),f;}catch(g){return console['error']('[Security]\x20IP\x20check\x20failed:',g),![];}}function handleAdminPanel(a,b){const c=b+'/login',d='<!DOCTYPE\x20html>\x0a<html\x20class=\x22dark\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<meta\x20name=\x22robots\x22\x20content=\x22noindex,\x20nofollow\x22>\x0a\x20\x20<title>Quantum\x20Shield\x20-\x20Secure\x20Access</title>\x0a\x20\x20\x0a\x20\x20<link\x20rel=\x22preconnect\x22\x20href=\x22https://fonts.googleapis.com\x22>\x0a\x20\x20<link\x20href=\x22https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap\x22\x20rel=\x22stylesheet\x22>\x0a\x20\x20<script\x20src=\x22https://cdn.tailwindcss.com\x22></script>\x0a\x20\x20\x0a\x20\x20<script>\x0a\x20\x20\x20\x20tailwind.config\x20=\x20{\x20\x0a\x20\x20\x20\x20\x20\x20darkMode:\x20\x22class\x22,\x0a\x20\x20\x20\x20\x20\x20theme:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20extend:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fontFamily:\x20{\x20sans:\x20[\x27Inter\x27,\x20\x27system-ui\x27,\x20\x27sans-serif\x27]\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20</script>\x0a\x20\x20\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20body\x20{\x20\x0a\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#667eea\x200%,\x20#764ba2\x20100%);\x0a\x20\x20\x20\x20\x20\x20font-family:\x20\x27Inter\x27,\x20sans-serif;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20@keyframes\x20float\x20{\x0a\x20\x20\x20\x20\x20\x200%,\x20100%\x20{\x20transform:\x20translateY(0px);\x20}\x0a\x20\x20\x20\x20\x20\x2050%\x20{\x20transform:\x20translateY(-20px);\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.float-animation\x20{\x20animation:\x20float\x206s\x20ease-in-out\x20infinite;\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body\x20class=\x22min-h-screen\x20flex\x20items-center\x20justify-center\x20p-4\x22>\x0a\x20\x20\x0a\x20\x20<div\x20class=\x22max-w-md\x20w-full\x20bg-slate-800\x20rounded-3xl\x20p-8\x20shadow-2xl\x22>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22text-center\x20mb-8\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22w-20\x20h-20\x20bg-gradient-to-br\x20from-blue-500\x20to-purple-600\x20rounded-2xl\x20flex\x20items-center\x20justify-center\x20mx-auto\x20mb-4\x20shadow-lg\x20float-animation\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22w-12\x20h-12\x20text-white\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20viewBox=\x220\x200\x2024\x2024\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20stroke-width=\x222\x22\x20d=\x22M13\x2010V3L4\x2014h7v7l9-11h-7z\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<h1\x20class=\x22text-3xl\x20font-black\x20text-white\x20mb-2\x22>Quantum\x20Shield</h1>\x0a\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-slate-400\x20text-sm\x22>Admin\x20Control\x20Panel\x20v'+CONFIG['VERSION']+'</p>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<form\x20id=\x22loginForm\x22\x20class=\x22space-y-5\x22>\x0a\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22block\x20text-sm\x20font-semibold\x20text-slate-300\x20mb-2\x22>Username</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type=\x22text\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22username\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20required\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20autocomplete=\x22username\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22w-full\x20bg-slate-900\x20border\x20border-slate-700\x20rounded-xl\x20px-4\x20py-3\x20text-white\x20placeholder-slate-500\x20focus:ring-2\x20focus:ring-blue-500\x20focus:border-transparent\x20outline-none\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22Enter\x20username\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22block\x20text-sm\x20font-semibold\x20text-slate-300\x20mb-2\x22>Password</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type=\x22password\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22password\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20required\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20autocomplete=\x22current-password\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22w-full\x20bg-slate-900\x20border\x20border-slate-700\x20rounded-xl\x20px-4\x20py-3\x20text-white\x20placeholder-slate-500\x20focus:ring-2\x20focus:ring-blue-500\x20focus:border-transparent\x20outline-none\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22Enter\x20password\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20'+(a['ADMIN_TOTP_SECRET']?'\x0a\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22block\x20text-sm\x20font-semibold\x20text-slate-300\x20mb-2\x22>2FA\x20Code</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type=\x22text\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22totp\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20required\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20maxlength=\x226\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22w-full\x20bg-slate-900\x20border\x20border-slate-700\x20rounded-xl\x20px-4\x20py-3\x20text-white\x20placeholder-slate-500\x20focus:ring-2\x20focus:ring-blue-500\x20focus:border-transparent\x20outline-none\x20text-center\x20text-2xl\x20tracking-widest\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20placeholder=\x22000000\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<button\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20type=\x22submit\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20id=\x22submitBtn\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20class=\x22w-full\x20bg-gradient-to-r\x20from-blue-500\x20to-purple-600\x20hover:from-blue-600\x20hover:to-purple-700\x20text-white\x20font-bold\x20py-4\x20rounded-xl\x20transition-all\x20shadow-lg\x22\x0a\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20id=\x22btnText\x22>Login\x20to\x20Dashboard</span>\x0a\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20id=\x22message\x22\x20class=\x22mt-5\x20p-4\x20rounded-xl\x20hidden\x22></div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22mt-8\x20pt-8\x20border-t\x20border-slate-700\x20space-y-3\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-3\x20text-xs\x20text-slate-400\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22w-4\x20h-4\x20text-green-500\x22\x20fill=\x22currentColor\x22\x20viewBox=\x220\x200\x2020\x2020\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20fill-rule=\x22evenodd\x22\x20d=\x22M10\x2018a8\x208\x200\x20100-16\x208\x208\x200\x20000\x2016zm3.707-9.293a1\x201\x200\x2000-1.414-1.414L9\x2010.586\x207.707\x209.293a1\x201\x200\x2000-1.414\x201.414l2\x202a1\x201\x200\x20001.414\x200l4-4z\x22\x20clip-rule=\x22evenodd\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>Quantum\x20Encryption\x20Active</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-3\x20text-xs\x20text-slate-400\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22w-4\x20h-4\x20text-green-500\x22\x20fill=\x22currentColor\x22\x20viewBox=\x220\x200\x2020\x2020\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20fill-rule=\x22evenodd\x22\x20d=\x22M10\x2018a8\x208\x200\x20100-16\x208\x208\x200\x20000\x2016zm3.707-9.293a1\x201\x200\x2000-1.414-1.414L9\x2010.586\x207.707\x209.293a1\x201\x200\x2000-1.414\x201.414l2\x202a1\x201\x200\x20001.414\x200l4-4z\x22\x20clip-rule=\x22evenodd\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>Individual\x20User\x20Panels</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-3\x20text-xs\x20text-slate-400\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<svg\x20class=\x22w-4\x20h-4\x20text-green-500\x22\x20fill=\x22currentColor\x22\x20viewBox=\x220\x200\x2020\x2020\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<path\x20fill-rule=\x22evenodd\x22\x20d=\x22M10\x2018a8\x208\x200\x20100-16\x208\x208\x200\x20000\x2016zm3.707-9.293a1\x201\x200\x2000-1.414-1.414L9\x2010.586\x207.707\x209.293a1\x201\x200\x2000-1.414\x201.414l2\x202a1\x201\x200\x20001.414\x200l4-4z\x22\x20clip-rule=\x22evenodd\x22></path>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</svg>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>Smart\x20Traffic\x20Management</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x0a\x20\x20</div>\x0a\x20\x20\x0a\x20\x20<script>\x0a\x20\x20\x20\x20const\x20form\x20=\x20document.getElementById(\x27loginForm\x27);\x0a\x20\x20\x20\x20const\x20submitBtn\x20=\x20document.getElementById(\x27submitBtn\x27);\x0a\x20\x20\x20\x20const\x20btnText\x20=\x20document.getElementById(\x27btnText\x27);\x0a\x20\x20\x20\x20const\x20messageDiv\x20=\x20document.getElementById(\x27message\x27);\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20form.addEventListener(\x27submit\x27,\x20async\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20const\x20username\x20=\x20document.getElementById(\x27username\x27).value;\x0a\x20\x20\x20\x20\x20\x20const\x20password\x20=\x20document.getElementById(\x27password\x27).value;\x0a\x20\x20\x20\x20\x20\x20const\x20totpInput\x20=\x20document.getElementById(\x27totp\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20totp\x20=\x20totpInput\x20?\x20totpInput.value\x20:\x20null;\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20submitBtn.disabled\x20=\x20true;\x0a\x20\x20\x20\x20\x20\x20btnText.textContent\x20=\x20\x27Authenticating...\x27;\x0a\x20\x20\x20\x20\x20\x20messageDiv.classList.add(\x27hidden\x27);\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20payload\x20=\x20{\x20username,\x20password\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(totp)\x20payload.totp\x20=\x20totp;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27'+c+'\x27,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27POST\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body:\x20JSON.stringify(payload)\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20result\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(result.success)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.className\x20=\x20\x27mt-5\x20p-4\x20rounded-xl\x20bg-green-500/20\x20text-green-400\x20border\x20border-green-500/30\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.innerHTML\x20=\x20\x27<span>‚úì\x20Login\x20successful!\x20Redirecting...</span>\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.classList.remove(\x27hidden\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localStorage.setItem(\x27authToken\x27,\x20result.token);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window.location.href\x20=\x20\x27'+CONFIG['PATHS']['API']+'/stats\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20},\x201500);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(result.message\x20||\x20\x27Login\x20failed\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.className\x20=\x20\x27mt-5\x20p-4\x20rounded-xl\x20bg-red-500/20\x20text-red-400\x20border\x20border-red-500/30\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.innerHTML\x20=\x20\x27<span>‚úó\x20\x27\x20+\x20error.message\x20+\x20\x27</span>\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20messageDiv.classList.remove(\x27hidden\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20}\x20finally\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20submitBtn.disabled\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20btnText.textContent\x20=\x20\x27Login\x20to\x20Dashboard\x27;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x20\x20</script>\x0a\x20\x20\x0a</body>\x0a</html>';return new Response(d,{'status':0xc8,'headers':{'Content-Type':'text/html;\x20charset=utf-8',...getSecurityHeaders()}});}async function handleAdminLogin(a,b,c){try{const d=await a['json']();if(!d['username']||!d['password'])return createJsonResponse({'error':'Missing\x20credentials'},0x190);const e=b['ADMIN_USERNAME']||'admin',f=b['ADMIN_PASSWORD']||'quantum2025';if(d['username']!==e||d['password']!==f)return console['warn']('[Security]\x20Failed\x20login\x20from\x20'+c),await new Promise(i=>setTimeout(i,0x7d0)),createJsonResponse({'error':'Invalid\x20credentials'},0x191);if(b['ADMIN_TOTP_SECRET']){if(!d['totp'])return createJsonResponse({'error':'2FA\x20code\x20required'},0x191);const i=verifyTOTP(d['totp'],b['ADMIN_TOTP_SECRET']);if(!i)return console['warn']('[Security]\x20Invalid\x20TOTP\x20from\x20'+c),createJsonResponse({'error':'Invalid\x202FA\x20code'},0x191);}const g=generateSecureToken(CONFIG['SECURITY']['TOKEN_LENGTH']),h=new Date(Date['now']()+CONFIG['SECURITY']['SESSION_TIMEOUT']);return cacheMap['set']('session_'+g,{'value':{'username':e,'ip':c,'created':Date['now']()},'timestamp':Date['now']()}),console['log']('[Security]\x20Successful\x20login:\x20'+e+'\x20from\x20'+c),createJsonResponse({'success':!![],'token':g,'expiresAt':h['toISOString'](),'user':{'username':e,'role':'admin'}});}catch(j){return console['error']('[Login]\x20Error:',j),createJsonResponse({'error':'Authentication\x20failed'},0x1f4);}}function handleHealthCheck(a,b){const c={'status':'healthy','version':CONFIG['VERSION'],'timestamp':new Date()['toISOString'](),'configuration':{'admin_path':b,'proxy_url':a['ROOT_PROXY_URL']||'default','totp_enabled':!!a['ADMIN_TOTP_SECRET'],'scamalytics_enabled':!!a['SCAMALYTICS_THRESHOLD'],'proxy_ip':a['PROXYIP']||'none'},'features':{'vless_protocol':!![],'user_panels':!![],'anti_filter':!![],'reverse_proxy':!![],'quantum_encryption':!![],'database':!!a['QUANTUM_DB']},'system':{'cache_size':cacheMap['size'],'rate_limit_records':rateMap['size']}};return createJsonResponse(c);}function handleFakePage(a){const b='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Cloud\x20Infrastructure\x20Service</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x27Segoe\x20UI\x27,\x20Roboto,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#f5f7fa\x200%,\x20#c3cfe2\x20100%);\x0a\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20padding:\x2060px;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x2024px;\x0a\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2025px\x2070px\x20rgba(0,0,0,0.15);\x0a\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20max-width:\x20600px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20h1\x20{\x20font-size:\x202.5rem;\x20color:\x20#2c3e50;\x20margin-bottom:\x2020px;\x20}\x0a\x20\x20\x20\x20p\x20{\x20font-size:\x201.1rem;\x20color:\x20#7f8c8d;\x20line-height:\x201.8;\x20}\x0a\x20\x20\x20\x20.status\x20{\x0a\x20\x20\x20\x20\x20\x20display:\x20inline-block;\x0a\x20\x20\x20\x20\x20\x20padding:\x2010px\x2020px;\x0a\x20\x20\x20\x20\x20\x20background:\x20#27ae60;\x0a\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x2050px;\x0a\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20margin:\x2020px\x200;\x0a\x20\x20\x20\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<h1>üëã\x20Welcome</h1>\x0a\x20\x20\x20\x20<div\x20class=\x22status\x22>‚úì\x20System\x20Operational</div>\x0a\x20\x20\x20\x20<p>This\x20is\x20a\x20standard\x20web\x20infrastructure\x20service\x20running\x20on\x20Cloudflare\x27s\x20global\x20network.</p>\x0a\x20\x20\x20\x20<p\x20style=\x22margin-top:\x2020px;\x20font-size:\x200.9rem;\x20color:\x20#95a5a6;\x22>Powered\x20by\x20Cloudflare\x20Workers</p>\x0a\x20\x20</div>\x0a</body>\x0a</html>';return new Response(b,{'status':0xc8,'headers':{'Content-Type':'text/html;\x20charset=utf-8',...getSecurityHeaders()}});}async function handleUserPanel(a,b){try{const c=a['pathname']['split']('/'),d=c[c['length']-0x1];if(!d||!isValidUUID(d))return new Response('Invalid\x20UUID\x20format',{'status':0x190,'headers':{'Content-Type':'text/plain;\x20charset=utf-8',...getSecurityHeaders()}});const e=await getUserData(d,b);if(!e)return new Response('User\x20not\x20found',{'status':0x194,'headers':{'Content-Type':'text/plain;\x20charset=utf-8',...getSecurityHeaders()}});const f=generateUserPanelHTML(e,a['hostname']);return new Response(f,{'status':0xc8,'headers':{'Content-Type':'text/html;\x20charset=utf-8','Cache-Control':'no-cache,\x20no-store,\x20must-revalidate',...getSecurityHeaders()}});}catch(g){return console['error']('[Panel]\x20Error:',g),createJsonResponse({'error':'Failed\x20to\x20load\x20panel'},0x1f4);}}function generateUserPanelHTML(a,b){const c=Number(a['traffic_used_gb'])||0x0,d=Number(a['traffic_limit_gb'])||0x1,e=generateVLESSLink(a['uuid'],b),f=Math['min'](0x64,Math['round'](c/d*0x64)),g=Math['max'](0x0,d-c)['toFixed'](0x2),h=new Date(a['expiry_date']),i=Math['max'](0x0,Math['ceil']((h['getTime']()-new Date()['getTime']())/0x5265c00)),j=a['status']==='active'?'green':'red',k=a['status']==='active'?'Active':'Inactive';return'<!DOCTYPE\x20html>\x0a<html\x20class=\x22dark\x22\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Quantum\x20Panel\x20-\x20'+escapeHtml(a['username']||'User')+'</title>\x0a\x20\x20<link\x20href=\x22https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap\x22\x20rel=\x22stylesheet\x22>\x0a\x20\x20<script\x20src=\x22https://cdn.tailwindcss.com\x22></script>\x0a\x20\x20<script>\x0a\x20\x20\x20\x20tailwind.config\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20darkMode:\x20\x22class\x22,\x0a\x20\x20\x20\x20\x20\x20theme:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20extend:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fontFamily:\x20{\x20sans:\x20[\x27Inter\x27,\x20\x27system-ui\x27,\x20\x27sans-serif\x27]\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20</script>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20::-webkit-scrollbar\x20{\x20width:\x208px;\x20}\x0a\x20\x20\x20\x20::-webkit-scrollbar-track\x20{\x20background:\x20#0f172a;\x20}\x0a\x20\x20\x20\x20::-webkit-scrollbar-thumb\x20{\x20background:\x20#334155;\x20border-radius:\x204px;\x20}\x0a\x20\x20\x20\x20@keyframes\x20pulse-glow\x20{\x0a\x20\x20\x20\x20\x20\x200%,\x20100%\x20{\x20opacity:\x201;\x20}\x0a\x20\x20\x20\x20\x20\x2050%\x20{\x20opacity:\x200.7;\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.animate-pulse-glow\x20{\x20animation:\x20pulse-glow\x202s\x20infinite;\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body\x20class=\x22bg-slate-900\x20text-white\x20min-h-screen\x22>\x0a\x20\x20\x0a\x20\x20<header\x20class=\x22sticky\x20top-0\x20z-50\x20bg-slate-800/90\x20backdrop-blur\x20border-b\x20border-slate-700\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22max-w-7xl\x20mx-auto\x20px-4\x20py-4\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20justify-between\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-3\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22w-10\x20h-10\x20rounded-xl\x20bg-gradient-to-br\x20from-blue-500\x20to-purple-600\x20flex\x20items-center\x20justify-center\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-2xl\x22>‚ö°</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22font-bold\x20text-xl\x22>Quantum\x20Shield</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x22>VLESS\x20v'+CONFIG['VERSION']['split']('-')[0x0]+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22px-3\x20py-1.5\x20bg-'+j+'-500/20\x20text-'+j+'-400\x20text-xs\x20font-bold\x20rounded-full\x20border\x20border-'+j+'-500/40\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22inline-block\x20w-2\x20h-2\x20rounded-full\x20bg-'+j+'-400\x20mr-1.5\x20animate-pulse-glow\x22></span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+k+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</header>\x0a\x0a\x20\x20<main\x20class=\x22max-w-7xl\x20mx-auto\x20px-4\x20py-8\x20space-y-8\x22>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22text-center\x20mb-10\x22>\x0a\x20\x20\x20\x20\x20\x20<h1\x20class=\x22text-4xl\x20font-black\x20mb-3\x20bg-clip-text\x20text-transparent\x20bg-gradient-to-r\x20from-white\x20to-blue-200\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Welcome,\x20'+escapeHtml(a['username']||'User')+'!\x0a\x20\x20\x20\x20\x20\x20</h1>\x0a\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-slate-400\x22>Manage\x20your\x20secure\x20connection</p>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22grid\x20grid-cols-1\x20sm:grid-cols-2\x20lg:grid-cols-4\x20gap-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-2xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-2\x20mb-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22h-3\x20w-3\x20rounded-full\x20bg-'+j+'-500\x20animate-pulse-glow\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20font-semibold\x22>Status</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-3xl\x20font-bold\x20mb-1\x22>'+k+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-'+j+'-400\x22>System\x20Online</p>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-2xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20font-semibold\x20block\x20mb-4\x22>Expires\x20In</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-3xl\x20font-bold\x20mb-1\x22>'+i+'\x20Days</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x22>'+h['toLocaleDateString']()+'</p>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-2xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20font-semibold\x20block\x20mb-4\x22>Device\x20Limit</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-3xl\x20font-bold\x20mb-1\x22>2\x20Devices</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x22>Concurrent</p>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-2xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20font-semibold\x20block\x20mb-4\x22>Remaining</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-3xl\x20font-bold\x20mb-1\x22>'+g+'\x20GB</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x22>Of\x20'+d+'\x20GB</p>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22grid\x20grid-cols-1\x20lg:grid-cols-3\x20gap-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22lg:col-span-2\x20space-y-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-3xl\x20p-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22text-xl\x20font-bold\x20mb-6\x22>üìä\x20Traffic\x20Usage</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22space-y-5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20text-sm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-slate-400\x20block\x20mb-1\x22>Used</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-white\x20font-mono\x20font-semibold\x20text-lg\x22>'+c['toFixed'](0x2)+'\x20GB</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22text-right\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-slate-400\x20block\x20mb-1\x22>Total</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-white\x20font-mono\x20font-semibold\x20text-lg\x22>'+d+'\x20GB</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22relative\x20h-5\x20bg-slate-900\x20rounded-full\x20overflow-hidden\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22absolute\x20h-full\x20bg-gradient-to-r\x20from-blue-500\x20to-purple-500\x20rounded-full\x20transition-all\x22\x20style=\x22width:\x20'+f+'%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20text-xs\x20text-slate-500\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>0\x20GB</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-blue-400\x20font-bold\x22>'+f+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+d+'\x20GB</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-3xl\x20p-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22text-xl\x20font-bold\x20mb-6\x22>üîó\x20Connection\x20Link</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22space-y-5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label\x20class=\x22text-sm\x20font-semibold\x20text-slate-300\x20block\x20mb-3\x22>VLESS\x20URI</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20gap-2\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20id=\x22vlessLink\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type=\x22text\x22\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20readonly\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value=\x22'+escapeHtml(e)+'\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22flex-1\x20bg-slate-900\x20border\x20border-slate-700\x20rounded-xl\x20py-3\x20px-4\x20text-sm\x20text-slate-300\x20font-mono\x20focus:outline-none\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20onclick=\x22copyLink()\x22\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20class=\x22bg-blue-500\x20hover:bg-blue-600\x20text-white\x20px-5\x20rounded-xl\x20transition-all\x20font-semibold\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Copy\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22pt-5\x20border-t\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-slate-400\x20mb-4\x22>Import\x20to\x20Client:</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x20grid-cols-2\x20sm:grid-cols-4\x20gap-3\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22flex\x20flex-col\x20items-center\x20gap-3\x20p-4\x20rounded-xl\x20bg-slate-900\x20border\x20border-slate-700\x20hover:border-orange-500\x20transition-all\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-3xl\x22>‚ö°</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20font-semibold\x22>Hiddify</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22flex\x20flex-col\x20items-center\x20gap-3\x20p-4\x20rounded-xl\x20bg-slate-900\x20border\x20border-slate-700\x20hover:border-blue-500\x20transition-all\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-3xl\x22>üöÄ</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20font-semibold\x22>V2rayNG</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22flex\x20flex-col\x20items-center\x20gap-3\x20p-4\x20rounded-xl\x20bg-slate-900\x20border\x20border-slate-700\x20hover:border-purple-500\x20transition-all\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-3xl\x22>üê±</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20font-semibold\x22>Clash</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22flex\x20flex-col\x20items-center\x20gap-3\x20p-4\x20rounded-xl\x20bg-slate-900\x20border\x20border-slate-700\x20hover:border-green-500\x20transition-all\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-3xl\x22>üõ°Ô∏è</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20font-semibold\x22>Exclave</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22space-y-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-3xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22text-xl\x20font-bold\x20mb-5\x22>üë§\x20Account</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<ul\x20class=\x22space-y-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li\x20class=\x22pb-4\x20border-b\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20block\x20mb-2\x22>UUID</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20font-mono\x20text-white\x20break-all\x22>'+escapeHtml(a['uuid'])+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li\x20class=\x22pb-4\x20border-b\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20block\x20mb-2\x22>Created</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-white\x22>'+new Date(a['created_at'])['toLocaleDateString']()+'</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20text-slate-400\x20uppercase\x20block\x20mb-2\x22>Plan</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-white\x20font-medium\x22>Premium</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</ul>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-800\x20border\x20border-slate-700\x20rounded-3xl\x20p-6\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20justify-between\x20mb-5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22text-xl\x20font-bold\x22>üåê\x20Connection</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-2\x20px-3\x20py-1.5\x20rounded-full\x20bg-green-500/10\x20border\x20border-green-500/30\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22w-2\x20h-2\x20rounded-full\x20bg-green-500\x20animate-pulse-glow\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22text-xs\x20font-bold\x20text-green-400\x22>LIVE</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22space-y-3\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-900\x20rounded-xl\x20p-4\x20border\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x20mb-2\x22>IP\x20Protection</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-green-400\x20font-bold\x22>‚úì\x20Enabled</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-900\x20rounded-xl\x20p-4\x20border\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x20mb-2\x22>Status</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-blue-400\x20font-bold\x22>‚ö°\x20Ready</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-slate-900\x20rounded-xl\x20p-4\x20border\x20border-slate-700\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-xs\x20text-slate-400\x20mb-2\x22>Encryption</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p\x20class=\x22text-sm\x20text-purple-400\x20font-bold\x22>üîí\x20TLS\x201.3</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20</main>\x0a\x0a\x20\x20<footer\x20class=\x22mt-16\x20py-8\x20text-center\x20text-slate-500\x20text-sm\x20border-t\x20border-slate-700\x22>\x0a\x20\x20\x20\x20<p>¬©\x202024\x20Quantum\x20Shield</p>\x0a\x20\x20\x20\x20<p\x20class=\x22text-xs\x20mt-2\x22>v'+CONFIG['VERSION']+'</p>\x0a\x20\x20</footer>\x0a\x0a\x20\x20<script>\x0a\x20\x20\x20\x20function\x20copyLink()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20input\x20=\x20document.getElementById(\x27vlessLink\x27);\x0a\x20\x20\x20\x20\x20\x20input.select();\x0a\x20\x20\x20\x20\x20\x20navigator.clipboard.writeText(input.value).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20button\x20=\x20event.currentTarget;\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20originalText\x20=\x20button.textContent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20button.textContent\x20=\x20\x27‚úì\x20Copied!\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20button.classList.add(\x27bg-green-500\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.textContent\x20=\x20originalText;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.classList.remove(\x27bg-green-500\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20},\x202000);\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x20\x20</script>\x0a\x0a</body>\x0a</html>';}async function handleVLESSConnection(a,b,c,d){try{const e=new WebSocketPair(),f=e[0x0],g=e[0x1];g['accept']();let h=new Uint8Array(0x0),i=![],j=null,k=null,l=null,m=0x0;return g['addEventListener']('message',async n=>{try{let o;if(n['data']instanceof ArrayBuffer)o=new Uint8Array(n['data']);else{if(typeof n['data']==='string')o=new TextEncoder()['encode'](n['data']);else{g['close'](0x3eb,'Unsupported\x20data');return;}}if(!i){h=concatenateUint8Arrays(h,o);if(h['length']<0x18)return;const p=h[0x0];if(p!==0x0){g['close'](0x3ea,'Invalid\x20version');return;}const q=h['slice'](0x1,0x11),r=convertBytesToUUID(q);l=await getUserData(r,b);if(!l||l['status']!=='active'){g['close'](0x3f0,'Unauthorized');return;}const s=await getActiveConnections(r,b);if(s>=CONFIG['SECURITY']['MAX_CONNECTIONS']){g['close'](0x3f0,'Too\x20many\x20connections');return;}let t=0x11;t++,t++;const u=h[t]<<0x8|h[t+0x1];t+=0x2;const v=h[t++];let w='';if(v===0x1)w=Array['from'](h['slice'](t,t+0x4))['join']('.'),t+=0x4;else{if(v===0x2){const x=h[t++];w=new TextDecoder()['decode'](h['slice'](t,t+x)),t+=x;}else{if(v===0x3){const y=h['slice'](t,t+0x10),z=[];for(let A=0x0;A<0x10;A+=0x2){z['push']((y[A]<<0x8|y[A+0x1])['toString'](0x10));}w=z['join'](':'),t+=0x10;}}}console['log']('[VLESS]\x20'+l['username']+'\x20->\x20'+w+':'+u);try{const B=b['PROXYIP']||w;j=connect({'hostname':B,'port':u}),k=j['writable']['getWriter']();const C=new Uint8Array([p,0x0]);g['send'](C['buffer']);if(h['length']>t){const D=h['slice'](t);await k['write'](D),m+=D['length'];}i=!![],pipeRemoteToClient(j,g,l,b),await registerActiveConnection(r,d,b);}catch(E){console['error']('[VLESS]\x20Connect\x20failed:',E),g['close'](0x3f3,'Connection\x20failed');}}else{if(k&&j)try{if(CONFIG['QUANTUM']['FRAGMENTATION']){const F=fragmentData(o);for(const G of F){await k['write'](G),m+=G['length'];}}else await k['write'](o),m+=o['length'];}catch(H){console['error']('[VLESS]\x20Write\x20failed:',H),g['close'](0x3f3);if(j)try{await j['close']();}catch(I){}}}}catch(J){console['error']('[VLESS]\x20Message\x20error:',J),g['close'](0x3f3);if(j)try{await j['close']();}catch(K){}}}),g['addEventListener']('close',async()=>{if(j)try{await j['close']();}catch(n){}if(l&&m>0x0){const o=m/(0x400*0x400*0x400);await updateUserTraffic(l['uuid'],o,b);}l&&await unregisterActiveConnection(l['uuid'],d,b);}),g['addEventListener']('error',n=>{console['error']('[VLESS]\x20WS\x20error:',n);if(j)try{j['close']();}catch(o){}}),new Response(null,{'status':0x65,'webSocket':f});}catch(n){return console['error']('[VLESS]\x20Handler\x20error:',n),createJsonResponse({'error':'Connection\x20failed'},0x1f4);}}async function pipeRemoteToClient(a,b,c,d){try{const f=a['readable']['getReader']();let g=0x0;while(!![]){const {done:h,value:i}=await f['read']();if(h)break;if(b['readyState']===WebSocket['OPEN']){if(CONFIG['QUANTUM']['PADDING']){const j=addRandomPadding(i);b['send'](j['buffer']),g+=j['length'];}else b['send'](i['buffer']),g+=i['length'];}else break;}if(g>0x0){const k=g/(0x400*0x400*0x400);await updateUserTraffic(c['uuid'],k,d);}}catch(l){console['error']('[Pipe]\x20Error:',l);}finally{try{if(b['readyState']===WebSocket['OPEN'])b['close']();}catch(m){}try{a['close']();}catch(n){}}}function fragmentData(a){const b=[];let c=0x0;while(c<a['length']){const d=Math['floor'](Math['random']()*(CONFIG['QUANTUM']['MAX_FRAGMENT']-CONFIG['QUANTUM']['MIN_FRAGMENT'])+CONFIG['QUANTUM']['MIN_FRAGMENT']),e=Math['min'](c+d,a['length']);b['push'](a['slice'](c,e)),c=e;}return b;}function addRandomPadding(a){const b=Math['floor'](Math['random']()*0x20),c=new Uint8Array(b);return crypto['getRandomValues'](c),concatenateUint8Arrays(a,c);}async function handleAPIRequest(a,b,c){try{const d=new URL(a['url']),e=d['pathname']['replace'](CONFIG['PATHS']['API'],''),f=a['headers']['get']('Authorization');if(!f||!f['startsWith']('Bearer\x20'))return createJsonResponse({'error':'Unauthorized'},0x191);const g=f['substring'](0x7),h=verifySessionToken(g);if(!h)return createJsonResponse({'error':'Invalid\x20token'},0x191);if(e==='/users'&&a['method']==='GET')return await listAllUsers(b);if(e==='/users'&&a['method']==='POST')return await createNewUser(a,b);if(e['startsWith']('/users/')&&a['method']==='DELETE'){const i=e['split']('/')[0x2];return await deleteUser(i,b);}if(e==='/stats')return await getSystemStats(b);return createJsonResponse({'error':'Not\x20found'},0x194);}catch(j){return console['error']('[API]\x20Error:',j),createJsonResponse({'error':'API\x20failed'},0x1f4);}}async function listAllUsers(a){try{if(!a['QUANTUM_DB'])return createJsonResponse({'users':[],'total':0x0});const b=await a['QUANTUM_DB']['prepare']('SELECT\x20id,\x20uuid,\x20username,\x20traffic_limit_gb,\x20traffic_used_gb,\x20expiry_date,\x20status,\x20created_at\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all'](),c=(b['results']||[])['map'](d=>({...d,'usage_percent':Math['round'](Number(d['traffic_used_gb'])/Number(d['traffic_limit_gb'])*0x64),'panel_url':'/panel/'+d['uuid']}));return createJsonResponse({'success':!![],'users':c,'total':c['length']});}catch(d){return console['error']('[API]\x20List\x20error:',d),createJsonResponse({'error':d['message']},0x1f4);}}async function createNewUser(a,b){try{if(!b['QUANTUM_DB'])return createJsonResponse({'error':'DB\x20not\x20configured'},0x1f7);const c=await a['json']();if(!c['username'])return createJsonResponse({'error':'Username\x20required'},0x190);const d=generateUUID(),e=c['expiry_date']||new Date(Date['now']()+0x1e*0x5265c00)['toISOString'](),f=c['traffic_limit_gb']||0x32;return await b['QUANTUM_DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20username,\x20traffic_limit_gb,\x20traffic_used_gb,\x20expiry_date,\x20status,\x20created_at)\x20VALUES\x20(?,\x20?,\x20?,\x200,\x20?,\x20?,\x20CURRENT_TIMESTAMP)')['bind'](d,c['username']['trim'](),f,e,'active')['run'](),createJsonResponse({'success':!![],'user':{'uuid':d,'username':c['username'],'traffic_limit_gb':f,'expiry_date':e,'panel_url':'/panel/'+d}},0xc9);}catch(g){return console['error']('[API]\x20Create\x20error:',g),createJsonResponse({'error':g['message']},0x1f4);}}async function deleteUser(a,b){try{if(!b['QUANTUM_DB'])return createJsonResponse({'error':'DB\x20not\x20configured'},0x1f7);return await b['QUANTUM_DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](a)['run'](),cacheMap['delete']('user_'+a),createJsonResponse({'success':!![]});}catch(c){return console['error']('[API]\x20Delete\x20error:',c),createJsonResponse({'error':c['message']},0x1f4);}}async function getSystemStats(a){try{if(!a['QUANTUM_DB'])return createJsonResponse({'system':{'version':CONFIG['VERSION'],'timestamp':new Date()['toISOString']()}});const b=await a['QUANTUM_DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20c\x20FROM\x20users')['first'](),c=await a['QUANTUM_DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20c\x20FROM\x20users\x20WHERE\x20status\x20=\x20?')['bind']('active')['first'](),d=await a['QUANTUM_DB']['prepare']('SELECT\x20SUM(traffic_used_gb)\x20as\x20used,\x20SUM(traffic_limit_gb)\x20as\x20allocated\x20FROM\x20users')['first']();return createJsonResponse({'success':!![],'system':{'version':CONFIG['VERSION'],'timestamp':new Date()['toISOString']()},'users':{'total':Number(b?.['c'])||0x0,'active':Number(c?.['c'])||0x0},'traffic':{'used_gb':Number(d?.['used'])||0x0,'allocated_gb':Number(d?.['allocated'])||0x0}});}catch(e){return console['error']('[Stats]\x20Error:',e),createJsonResponse({'error':e['message']},0x1f4);}}async function getUserData(a,b){try{const c='user_'+a,d=cacheMap['get'](c);if(d&&Date['now']()-d['timestamp']<0xea60)return d['value'];if(b['QUANTUM_DB']){const e=await b['QUANTUM_DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?\x20LIMIT\x201')['bind'](a)['first']();if(e)return cacheMap['set'](c,{'value':e,'timestamp':Date['now']()}),e;}return null;}catch(f){return console['error']('[DB]\x20Get\x20user\x20error:',f),null;}}async function updateUserTraffic(a,b,c){try{if(!c['QUANTUM_DB']||b<=0x0)return;await c['QUANTUM_DB']['prepare']('UPDATE\x20users\x20SET\x20traffic_used_gb\x20=\x20traffic_used_gb\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](b,a)['run'](),cacheMap['delete']('user_'+a);}catch(d){console['error']('[DB]\x20Update\x20traffic\x20error:',d);}}async function registerActiveConnection(a,b,c){const d='active_conn_'+a+'_'+b;cacheMap['set'](d,{'value':{'connected_at':Date['now']()},'timestamp':Date['now']()});}async function unregisterActiveConnection(a,b,c){const d='active_conn_'+a+'_'+b;cacheMap['delete'](d);}async function getActiveConnections(a,b){let c=0x0;for(const [d,e]of cacheMap['entries']()){d['startsWith']('active_conn_'+a+'_')&&(Date['now']()-e['timestamp']<0x493e0&&c++);}return c;}function checkRateLimit(a){const b=Date['now'](),c=0xea60,d=rateMap['get'](a);if(!d)return rateMap['set'](a,{'count':0x1,'resetTime':b+c}),!![];if(b>d['resetTime'])return d['count']=0x1,d['resetTime']=b+c,!![];return d['count']++,d['count']<=CONFIG['SECURITY']['RATE_LIMIT'];}function verifySessionToken(a){const b='session_'+a,c=cacheMap['get'](b);if(!c)return null;const d=Date['now']()-c['timestamp'];if(d>CONFIG['SECURITY']['SESSION_TIMEOUT'])return cacheMap['delete'](b),null;return c['value'];}function verifyTOTP(a,b){try{if(!a||!b||a['length']!==0x6)return![];const c=Math['floor'](Date['now']()/0x7530),d=/^\d{6}$/['test'](a);return d;}catch(e){return console['error']('[TOTP]\x20Verification\x20error:',e),![];}}function isValidUUID(a){const b=/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function generateUUID(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'['replace'](/[xy]/g,a=>{const b=Math['random']()*0x10|0x0,d=a==='x'?b:b&0x3|0x8;return d['toString'](0x10);});}function generateSecureToken(a){const b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let c='';for(let d=0x0;d<a;d++){c+=b['charAt'](Math['floor'](Math['random']()*b['length']));}return c;}function convertBytesToUUID(a){const b=Array['from'](a,c=>c['toString'](0x10)['padStart'](0x2,'0'))['join']('');return[b['slice'](0x0,0x8),b['slice'](0x8,0xc),b['slice'](0xc,0x10),b['slice'](0x10,0x14),b['slice'](0x14,0x20)]['join']('-');}function concatenateUint8Arrays(...a){const b=a['reduce']((e,f)=>e+f['length'],0x0),c=new Uint8Array(b);let d=0x0;for(const e of a){c['set'](e,d),d+=e['length'];}return c;}function generateVLESSLink(a,b){const c=new URLSearchParams({'encryption':'none','security':'tls','sni':b,'fp':'chrome','type':'ws','host':b,'path':CONFIG['PATHS']['VLESS']});return'vless://'+a+'@'+b+':443?'+c['toString']()+'#Quantum-'+a['substring'](0x0,0x8);}function escapeHtml(a){if(typeof a!=='string')return'';const b={'&':'&amp;','<':'&lt;','>':'&gt;','\x22':'&quot;','\x27':'&#39;'};return a['replace'](/[&<>"']/g,d=>b[d]);}function isValidURL(a){try{const b=new URL(a);return b['protocol']==='http:'||b['protocol']==='https:';}catch{return![];}}function isPrivateIP(a){if(a==='unknown'||a==='localhost'||a==='127.0.0.1')return!![];const b=a['split']('.')['map'](Number);if(b['length']!==0x4)return![];if(b[0x0]===0xa)return!![];if(b[0x0]===0xac&&b[0x1]>=0x10&&b[0x1]<=0x1f)return!![];if(b[0x0]===0xc0&&b[0x1]===0xa8)return!![];return![];}function getSecurityHeaders(){return{'X-Content-Type-Options':'nosniff','X-Frame-Options':'DENY','X-XSS-Protection':'1;\x20mode=block','Referrer-Policy':'no-referrer','Strict-Transport-Security':'max-age=31536000'};}function getCorsHeaders(){return{'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Access-Control-Allow-Headers':'Content-Type,\x20Authorization','Access-Control-Max-Age':'86400',...getSecurityHeaders()};}function createJsonResponse(a,b=0xc8){return new Response(JSON['stringify'](a,null,0x2),{'status':b,'headers':{'Content-Type':'application/json;\x20charset=utf-8',...getCorsHeaders()}});}