// <!--GAMFC-->version base on commit: fa9820c08f67a9f248b835402c10c20762bc3d7e - last update: 2025-12-25 17:56:26 UTC <!--GAMFC-END-->.

import{connect}from'cloudflare:sockets';const CONFIG={'VERSION':'8.0.0-FINAL','BUILD_DATE':'2025-12-25','PATHS':{'ADMIN':'/quantum-admin-v8','API':'/api/v3','VLESS_WS':'/vless-quantum','SUBSCRIPTION':'/sub','HEALTH':'/health','METRICS':'/metrics'},'SECURITY':{'MAX_CONNECTIONS':0xf,'RATE_LIMIT':0x12c,'SESSION_TIMEOUT':0x18,'MAX_LOGIN_ATTEMPTS':0x5},'QUANTUM':{'FRAGMENTATION':!![],'PADDING':!![],'TIMING_OBFUSCATION':!![],'TLS_RANDOMIZATION':!![],'MULTI_PATH':!![],'ENCRYPTION':!![],'NOISE_INJECTION':!![],'FAST_PATH':!![],'MIN_FRAGMENT':0x80,'MAX_FRAGMENT':0x578,'PADDING_PROB':0.6,'MAX_PADDING':0x200,'JITTER_MS':0x32,'NOISE_RATIO':0.15},'PERF':{'TIMEOUT':0x2ee0,'IDLE':0x493e0,'BUFFER':0x10000,'RETRIES':0x5,'RETRY_BASE':0x1f4,'RETRY_MAX':0x1388},'TRAFFIC':{'FLUSH_MS':0xea60,'MAX_BUFFER':0x32,'MAX_MB':0xa},'SNI':['www.speedtest.net','cloudflare.com','workers.dev','cdnjs.cloudflare.com'],'PROXY':['bpb.yousef.isegaro.com','cdn.xn--b6gac.eu.org']},MAX_MAP=0x2710,RATE_MAP=new Map(),CACHE_MAP=new Map(),TRAFFIC_MAP=new Map(),KEY_MAP=new Map();let flushTime=Date['now'](),startTime=Date['now'](),dbReady=![];const proc={'uptime':()=>(Date['now']()-startTime)/0x3e8};export default{async 'fetch'(a,b,c){try{if(!dbReady)c['waitUntil'](initSys(b));const d=new URL(a['url']),e=getIP(a);if(a['method']==='OPTIONS')return new Response(null,{'status':0xcc,'headers':cors()});if(d['pathname']===CONFIG['PATHS']['HEALTH'])return health(b);if(d['pathname']===CONFIG['PATHS']['METRICS'])return metrics(b);const f=checkRate(e);if(!f['ok'])return json({'error':'Rate\x20limit','retryAfter':f['retry']},0x1ad);if(await isBanned(e,b))return fake();const g=a['headers']['get']('Upgrade');if(g==='websocket'&&d['pathname']===CONFIG['PATHS']['VLESS_WS'])return await vless(a,b,c,e);if(d['pathname']['startsWith'](CONFIG['PATHS']['API']))return await api(a,b,e);if(d['pathname']==='/admin-login'&&a['method']==='POST')return await login(a,b,e);if(d['pathname']===CONFIG['PATHS']['ADMIN'])return adminUI();if(d['pathname']['startsWith'](CONFIG['PATHS']['SUBSCRIPTION']+'/'))return await sub(a,b);return fake();}catch(h){return console['error']('Worker\x20error:',h),c['waitUntil'](logErr(b,h,'fetch')),json({'error':'Service\x20error'},0x1f7);}},async 'scheduled'(a,b,c){console['log']('Scheduled\x20tasks\x20running...'),c['waitUntil'](Promise['allSettled']([flushTraffic(b),cleanExpired(b),rotateKeys(),cleanMem(),cleanLogs(b)]));}};async function initSys(a){if(dbReady)return;try{await initDB(a),await initKeys(),dbReady=!![],console['log']('‚úÖ\x20System\x20ready');}catch(b){console['error']('Init\x20error:',b);}}async function initDB(a){if(!a['QUANTUM_DB']){console['warn']('DB\x20not\x20configured');return;}try{const b=['CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20UNIQUE\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20username\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit_gb\x20REAL\x20DEFAULT\x2050,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_used_gb\x20REAL\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20expiry_date\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20status\x20TEXT\x20DEFAULT\x20\x27active\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20last_login\x20TEXT\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20logs\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20type\x20TEXT\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip_address\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20message\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20banned_ips\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20reason\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20banned_until\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20sessions\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20id\x20INTEGER\x20PRIMARY\x20KEY\x20AUTOINCREMENT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20user_id\x20INTEGER\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20token\x20TEXT\x20UNIQUE\x20NOT\x20NULL,\x0a\x20\x20\x20\x20\x20\x20\x20\x20ip_address\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20expires_at\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20TEXT\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20)'];for(const d of b)await a['QUANTUM_DB']['prepare'](d)['run']();const c=['CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_users_uuid\x20ON\x20users(uuid)','CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_users_status\x20ON\x20users(status)','CREATE\x20INDEX\x20IF\x20NOT\x20EXISTS\x20idx_sessions_token\x20ON\x20sessions(token)'];for(const e of c)await a['QUANTUM_DB']['prepare'](e)['run']();console['log']('‚úÖ\x20DB\x20ready');}catch(f){console['error']('DB\x20init\x20error:',f);}}async function initKeys(){for(let a=0x0;a<0xa;a++){KEY_MAP['set']('key_'+a,{'val':token(0x20),'time':Date['now'](),'uses':0x0});}console['log']('‚úÖ\x20Keys\x20ready');}async function vless(a,b,c,d){try{const e=new WebSocketPair(),[f,g]=Object['values'](e);g['accept']();let h=new Uint8Array(0x0),i=null,j=null,k=null,l=![];return g['addEventListener']('message',async m=>{try{const n=new Uint8Array(await m['data']['arrayBuffer']());if(!l){h=concat(h,n);if(h['length']<0x17)return;const o=h[0x0];if(o!==0x0){console['error']('Bad\x20version'),closeAll(g,i);return;}const p=toUUID(h['slice'](0x1,0x11));k=await getUser(p,b);if(!k||k['status']!=='active'){console['error']('Bad\x20user'),closeAll(g,i);return;}c['waitUntil'](updateLogin(k['id'],b));let q=0x12;const r=h[q++],s=h[q]<<0x8|h[q+0x1];q+=0x2;const t=h[q++];let u='';if(t===0x1)u=Array['from'](h['slice'](q,q+0x4))['join']('.'),q+=0x4;else{if(t===0x2){const w=h[q++];u=new TextDecoder()['decode'](h['slice'](q,q+w)),q+=w;}else{if(t===0x3){const x=h['slice'](q,q+0x10);u=Array['from'](x,y=>y['toString'](0x10)['padStart'](0x2,'0'))['reduce']((y,z,A)=>y+(A%0x2===0x0?A>0x0?':':'':'')+z,''),q+=0x10;}else{console['error']('Bad\x20address\x20type'),closeAll(g,i);return;}}}console['log']('Connect\x20to\x20'+u+':'+s),i=await connRetry(u,s);if(!i){console['error']('Connect\x20failed'),closeAll(g,i);return;}j=i['writable']['getWriter']();const v=new Uint8Array([o,0x0]);g['send'](v);if(h['length']>q){const y=h['slice'](q),z=await procOut(y);await safeWrite(j,z);}l=!![],pipe(i,g,k,b,c);}else{if(j){const A=await procOut(n);await safeWrite(j,A);}}if(k)c['waitUntil'](track(k['id'],n['length'],b));}catch(B){console['error']('Message\x20error:',B),closeAll(g,i);}}),g['addEventListener']('close',()=>{console['log']('Client\x20closed'),closeAll(null,i);}),g['addEventListener']('error',m=>{console['error']('WS\x20error:',m),closeAll(g,i);}),new Response(null,{'status':0x65,'webSocket':f});}catch(m){return console['error']('VLESS\x20error:',m),json({'error':'Failed'},0x1f4);}}async function pipe(a,b,c,d,e){try{const f=a['readable']['getReader']();while(!![]){const {done:g,value:h}=await f['read']();if(g)break;const i=await procIn(h);if(b['readyState']===WebSocket['OPEN'])b['send'](i);else break;if(c)e['waitUntil'](track(c['id'],h['length'],d));}}catch(j){console['error']('Pipe\x20error:',j);}finally{closeAll(b,a);}}async function safeWrite(a,b){try{await a['write'](b);}catch(c){console['error']('Write\x20error:',c);throw c;}}function closeAll(a,b){try{if(a&&a['readyState']===WebSocket['OPEN'])a['close']();}catch(c){}try{if(b)b['close']();}catch(d){}}async function connRetry(a,b){for(let c=0x0;c<CONFIG['PERF']['RETRIES'];c++){try{const d=pickSNI(),e=connect({'hostname':a,'port':b},{'secureTransport':'on','allowHalfOpen':!![]});return console['log']('Connected\x20(try\x20'+(c+0x1)+')'),e;}catch(f){console['error']('Try\x20'+(c+0x1)+'\x20failed:',f['message']);if(c<CONFIG['PERF']['RETRIES']-0x1){const g=Math['min'](CONFIG['PERF']['RETRY_BASE']*Math['pow'](0x2,c),CONFIG['PERF']['RETRY_MAX']);await sleep(g);}}}return null;}async function procOut(a){try{let b=a;if(a['length']<0x64&&CONFIG['QUANTUM']['FAST_PATH'])return a;if(CONFIG['QUANTUM']['ENCRYPTION'])b=xor(b);CONFIG['QUANTUM']['FRAGMENTATION']&&a['length']>CONFIG['QUANTUM']['MIN_FRAGMENT']&&(b=await frag(b));CONFIG['QUANTUM']['PADDING']&&Math['random']()<CONFIG['QUANTUM']['PADDING_PROB']&&(b=pad(b));if(CONFIG['QUANTUM']['TIMING_OBFUSCATION'])await delay();return b;}catch(c){return console['error']('ProcOut\x20error:',c),a;}}async function procIn(a){try{let b=a;if(CONFIG['QUANTUM']['PADDING'])b=unpad(b);if(CONFIG['QUANTUM']['ENCRYPTION'])b=xor(b);return b;}catch(c){return console['error']('ProcIn\x20error:',c),a;}}async function frag(a){try{if(a['length']<=CONFIG['QUANTUM']['MIN_FRAGMENT'])return a;const b=[],c=CONFIG['QUANTUM']['MIN_FRAGMENT'],d=CONFIG['QUANTUM']['MAX_FRAGMENT'];let e=0x0;while(e<a['length']){const f=Math['min'](Math['floor'](Math['random']()*(d-c+0x1))+c,a['length']-e);b['push'](a['slice'](e,e+f)),e+=f;if(e<a['length'])await delay();}return concat(...b);}catch(g){return console['error']('Frag\x20error:',g),a;}}function xor(a){try{const b=Math['floor'](Math['random']()*KEY_MAP['size']),c=KEY_MAP['get']('key_'+b);if(!c)return a;const d=new TextEncoder()['encode'](c['val']),e=new Uint8Array(a['length']);for(let f=0x0;f<a['length'];f++){e[f]=a[f]^d[f%d['length']];}return c['uses']++,e;}catch(g){return a;}}function pad(a){try{const b=Math['floor'](Math['random']()*CONFIG['QUANTUM']['MAX_PADDING']);if(b===0x0)return a;const c=new Uint8Array(b);crypto['getRandomValues'](c);const d=new Uint8Array(a['length']+b+0x2);return d[0x0]=b>>0x8&0xff,d[0x1]=b&0xff,d['set'](a,0x2),d['set'](c,a['length']+0x2),d;}catch(e){return a;}}function unpad(a){try{if(a['length']<0x2)return a;const b=a[0x0]<<0x8|a[0x1];if(b===0x0||b>a['length']-0x2)return a;return a['slice'](0x2,a['length']-b);}catch(c){return a;}}async function track(a,b,c){try{const d=TRAFFIC_MAP['get'](a)||0x0;TRAFFIC_MAP['set'](a,d+b);const e=Date['now'](),f=e-flushTime,g=Array['from'](TRAFFIC_MAP['values']())['reduce']((h,i)=>h+i,0x0)/(0x400*0x400);(f>CONFIG['TRAFFIC']['FLUSH_MS']||TRAFFIC_MAP['size']>=CONFIG['TRAFFIC']['MAX_BUFFER']||g>=CONFIG['TRAFFIC']['MAX_MB'])&&await flushTraffic(c);}catch(h){console['error']('Track\x20error:',h);}}async function flushTraffic(a){if(TRAFFIC_MAP['size']===0x0)return;try{if(!a['QUANTUM_DB'])return;const b=[];for(const [c,d]of TRAFFIC_MAP['entries']()){const e=d/(0x400*0x400*0x400);b['push'](a['QUANTUM_DB']['prepare']('UPDATE\x20users\x20SET\x20traffic_used_gb\x20=\x20traffic_used_gb\x20+\x20?\x20WHERE\x20id\x20=\x20?')['bind'](e,c));}await a['QUANTUM_DB']['batch'](b),console['log']('‚úÖ\x20Flushed\x20'+TRAFFIC_MAP['size']+'\x20users'),TRAFFIC_MAP['clear'](),flushTime=Date['now']();}catch(f){console['error']('Flush\x20error:',f);}}function checkRate(a){const b=Date['now'](),c=0xea60;if(!RATE_MAP['has'](a))return RATE_MAP['set'](a,{'cnt':0x1,'reset':b+c}),{'ok':!![]};const d=RATE_MAP['get'](a);if(b>d['reset'])return d['cnt']=0x1,d['reset']=b+c,{'ok':!![]};d['cnt']++;if(d['cnt']>CONFIG['SECURITY']['RATE_LIMIT'])return{'ok':![],'retry':Math['ceil']((d['reset']-b)/0x3e8)};return{'ok':!![]};}async function getUser(a,b){try{const c='user_'+a;if(CACHE_MAP['has'](c)){const d=CACHE_MAP['get'](c);if(Date['now']()-d['time']<0xea60)return d['val'];}if(b['QUANTUM_DB']){const e=await b['QUANTUM_DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?\x20LIMIT\x201')['bind'](a)['first']();if(e)CACHE_MAP['set'](c,{'val':e,'time':Date['now']()});return e;}return{'id':0x1,'uuid':a,'status':'active','traffic_limit_gb':0x64,'traffic_used_gb':0x0};}catch(f){return console['error']('Get\x20user\x20error:',f),null;}}async function updateLogin(a,b){try{if(!b['QUANTUM_DB'])return;await b['QUANTUM_DB']['prepare']('UPDATE\x20users\x20SET\x20last_login\x20=\x20datetime(\x22now\x22)\x20WHERE\x20id\x20=\x20?')['bind'](a)['run']();}catch(c){console['error']('Update\x20login\x20error:',c);}}async function isBanned(a,b){try{const c='ban_'+a;if(CACHE_MAP['has'](c)){const d=CACHE_MAP['get'](c);if(Date['now']()-d['time']<0x493e0)return d['val'];}if(b['QUANTUM_DB']){const e=await b['QUANTUM_DB']['prepare']('SELECT\x201\x20FROM\x20banned_ips\x20WHERE\x20ip\x20=\x20?\x20AND\x20(banned_until\x20IS\x20NULL\x20OR\x20banned_until\x20>\x20datetime(\x22now\x22))')['bind'](a)['first'](),f=!!e;return CACHE_MAP['set'](c,{'val':f,'time':Date['now']()}),f;}return![];}catch(g){return console['error']('Check\x20ban\x20error:',g),![];}}async function login(a,b,c){try{const d=await a['json'](),{username:e,password:f}=d;if(!e||!f)return json({'error':'Missing\x20credentials'},0x190);const g=b['ADMIN_USERNAME']||'admin',h=b['ADMIN_PASSWORD']||'quantum-2025';if(e!==g||f!==h)return await log(b,'failed_login',null,c),json({'error':'Invalid\x20credentials'},0x191);const i=token(0x20),j=new Date(Date['now']()+CONFIG['SECURITY']['SESSION_TIMEOUT']*0x36ee80);return b['QUANTUM_DB']&&await b['QUANTUM_DB']['prepare']('INSERT\x20INTO\x20sessions\x20(user_id,\x20token,\x20ip_address,\x20expires_at)\x20VALUES\x20(?,\x20?,\x20?,\x20?)')['bind'](0x0,i,c,j['toISOString']())['run'](),CACHE_MAP['set']('sess_'+i,{'val':{'user_id':0x0,'token':i,'ip_address':c},'time':Date['now']()}),json({'success':!![],'token':i,'expiresAt':j['toISOString']()});}catch(k){return console['error']('Login\x20error:',k),json({'error':'Login\x20failed'},0x1f4);}}async function api(a,b,c){try{const d=new URL(a['url']),e=d['pathname']['replace'](CONFIG['PATHS']['API'],''),f=a['headers']['get']('Authorization');if(!f||!f['startsWith']('Bearer\x20'))return json({'error':'Unauthorized'},0x191);const g=f['substring'](0x7),h=await verifySess(g,b);if(!h)return json({'error':'Invalid\x20token'},0x191);if(e==='/users'&&a['method']==='GET')return await listUsers(b);if(e==='/users'&&a['method']==='POST')return await addUser(a,b);if(e['startsWith']('/users/')&&a['method']==='GET')return await showUser(e['split']('/')[0x2],b);if(e['startsWith']('/users/')&&a['method']==='PUT')return await editUser(e['split']('/')[0x2],a,b);if(e['startsWith']('/users/')&&a['method']==='DELETE')return await delUser(e['split']('/')[0x2],b);if(e==='/stats'&&a['method']==='GET')return await stats(b);return json({'error':'Not\x20found'},0x194);}catch(i){return console['error']('API\x20error:',i),json({'error':'Internal\x20error'},0x1f4);}}async function verifySess(a,b){try{const c='sess_'+a;if(CACHE_MAP['has'](c)){const d=CACHE_MAP['get'](c);if(Date['now']()-d['time']<0x493e0)return d['val'];}if(b['QUANTUM_DB']){const e=await b['QUANTUM_DB']['prepare']('SELECT\x20*\x20FROM\x20sessions\x20WHERE\x20token\x20=\x20?\x20AND\x20expires_at\x20>\x20datetime(\x22now\x22)\x20LIMIT\x201')['bind'](a)['first']();if(e)CACHE_MAP['set'](c,{'val':e,'time':Date['now']()});return e;}return null;}catch(f){return null;}}async function listUsers(a){try{if(!a['QUANTUM_DB'])return json({'error':'DB\x20not\x20configured'},0x1f7);const b=await a['QUANTUM_DB']['prepare']('SELECT\x20id,\x20uuid,\x20username,\x20traffic_limit_gb,\x20traffic_used_gb,\x20expiry_date,\x20status,\x20created_at,\x20last_login\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return json({'users':b['results']||[]});}catch(c){return console['error']('List\x20users\x20error:',c),json({'error':'Failed'},0x1f4);}}async function addUser(a,b){try{if(!b['QUANTUM_DB'])return json({'error':'DB\x20not\x20configured'},0x1f7);const c=await a['json'](),d=genUUID(),e=c['expiry_date']||new Date(Date['now']()+0x1e*0x5265c00)['toISOString']();return await b['QUANTUM_DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20username,\x20traffic_limit_gb,\x20expiry_date)\x20VALUES\x20(?,\x20?,\x20?,\x20?)')['bind'](d,c['username'],c['traffic_limit_gb']||0x32,e)['run'](),json({'success':!![],'user':{'uuid':d,'username':c['username'],'traffic_limit_gb':c['traffic_limit_gb']||0x32}});}catch(f){return console['error']('Add\x20user\x20error:',f),json({'error':'Failed'},0x1f4);}}async function showUser(a,b){try{const c=await getUser(a,b);if(!c)return json({'error':'Not\x20found'},0x194);return json({'user':c});}catch(d){return json({'error':'Failed'},0x1f4);}}async function editUser(a,b,c){try{if(!c['QUANTUM_DB'])return json({'error':'DB\x20not\x20configured'},0x1f7);const d=await b['json'](),e=[],f=[];d['traffic_limit_gb']!==undefined&&(e['push']('traffic_limit_gb\x20=\x20?'),f['push'](d['traffic_limit_gb']));d['expiry_date']!==undefined&&(e['push']('expiry_date\x20=\x20?'),f['push'](d['expiry_date']));d['status']!==undefined&&(e['push']('status\x20=\x20?'),f['push'](d['status']));if(e['length']===0x0)return json({'error':'No\x20updates'},0x190);return f['push'](a),await c['QUANTUM_DB']['prepare']('UPDATE\x20users\x20SET\x20'+e['join'](',\x20')+'\x20WHERE\x20uuid\x20=\x20?')['bind'](...f)['run'](),CACHE_MAP['delete']('user_'+a),json({'success':!![]});}catch(g){return json({'error':'Failed'},0x1f4);}}async function delUser(a,b){try{if(!b['QUANTUM_DB'])return json({'error':'DB\x20not\x20configured'},0x1f7);return await b['QUANTUM_DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](a)['run'](),CACHE_MAP['delete']('user_'+a),json({'success':!![]});}catch(c){return json({'error':'Failed'},0x1f4);}}async function stats(a){try{if(!a['QUANTUM_DB'])return json({'error':'DB\x20not\x20configured'},0x1f7);const b=await a['QUANTUM_DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')['first'](),c=await a['QUANTUM_DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users\x20WHERE\x20status\x20=\x20\x22active\x22')['first'](),d=await a['QUANTUM_DB']['prepare']('SELECT\x20SUM(traffic_used_gb)\x20as\x20total\x20FROM\x20users')['first']();return json({'totalUsers':b?.['count']||0x0,'activeUsers':c?.['count']||0x0,'totalTrafficGB':d?.['total']||0x0,'uptime':proc['uptime'](),'version':CONFIG['VERSION'],'bufferedTraffic':TRAFFIC_MAP['size']});}catch(e){return json({'error':'Failed'},0x1f4);}}async function sub(a,b){try{const c=new URL(a['url']),d=c['pathname']['split']('/')['pop']();if(!validUUID(d))return new Response('Invalid\x20UUID',{'status':0x190});const e=await getUser(d,b);if(!e||e['status']!=='active')return new Response('Not\x20found',{'status':0x194});const f=c['hostname'],g=pickSNI(),h='vless://'+e['uuid']+'@'+f+':443?encryption=none&security=tls&sni='+g+'&type=ws&host='+f+'&path='+encodeURIComponent(CONFIG['PATHS']['VLESS_WS'])+'#Quantum-WS',i=btoa(h);return new Response(i,{'headers':{'Content-Type':'text/plain;\x20charset=utf-8','Content-Disposition':'attachment;\x20filename=\x22quantum-'+e['uuid']+'.txt\x22','Subscription-Userinfo':'upload=0;\x20download='+Math['floor'](e['traffic_used_gb']*0x40000000)+';\x20total='+Math['floor'](e['traffic_limit_gb']*0x40000000)}});}catch(j){return console['error']('Sub\x20error:',j),new Response('Failed',{'status':0x1f4});}}function health(a){const b={'status':'healthy','version':CONFIG['VERSION'],'uptime':Math['floor'](proc['uptime']()),'memory':{'rateLimiter':RATE_MAP['size'],'cache':CACHE_MAP['size'],'trafficBuffer':TRAFFIC_MAP['size'],'quantumKeys':KEY_MAP['size']},'database':a['QUANTUM_DB']?'connected':'not\x20configured','timestamp':new Date()['toISOString']()};return json(b);}function metrics(a){const b={'system':{'uptime':proc['uptime'](),'version':CONFIG['VERSION']},'performance':{'trafficBufferSize':TRAFFIC_MAP['size'],'lastFlushTime':new Date(flushTime)['toISOString'](),'cacheSize':CACHE_MAP['size']},'memory':{'rateLimiter':RATE_MAP['size'],'cache':CACHE_MAP['size'],'trafficBuffer':TRAFFIC_MAP['size']},'timestamp':new Date()['toISOString']()};return json(b);}async function cleanExpired(a){try{if(!a['QUANTUM_DB'])return;await a['QUANTUM_DB']['prepare']('UPDATE\x20users\x20SET\x20status\x20=\x20\x22expired\x22\x20WHERE\x20expiry_date\x20<\x20datetime(\x22now\x22)\x20AND\x20status\x20=\x20\x22active\x22')['run'](),console['log']('‚úÖ\x20Expired\x20users\x20cleaned');}catch(b){console['error']('Clean\x20expired\x20error:',b);}}async function rotateKeys(){try{const a=Array['from'](KEY_MAP['entries']())['sort']((c,d)=>c[0x1]['time']-d[0x1]['time'])[0x0];a&&KEY_MAP['set'](a[0x0],{'val':token(0x20),'time':Date['now'](),'uses':0x0}),console['log']('üîÑ\x20Keys\x20rotated');}catch(b){console['error']('Rotate\x20error:',b);}}function cleanMem(){const a=Date['now']();let b=0x0;if(CACHE_MAP['size']>MAX_MAP){const c=Array['from'](CACHE_MAP['entries']());c['sort']((e,f)=>(e[0x1]['time']||0x0)-(f[0x1]['time']||0x0));const d=c['slice'](0x0,Math['floor'](CACHE_MAP['size']*0.3));for(const [e]of d){CACHE_MAP['delete'](e),b++;}}for(const [f,g]of RATE_MAP['entries']()){a>g['reset']&&(RATE_MAP['delete'](f),b++);}console['log']('‚úÖ\x20Memory\x20cleaned:\x20'+b+'\x20entries');}async function cleanLogs(a){try{if(!a['QUANTUM_DB'])return;await a['QUANTUM_DB']['prepare']('DELETE\x20FROM\x20logs\x20WHERE\x20created_at\x20<\x20datetime(\x22now\x22,\x20\x22-7\x20days\x22)')['run'](),console['log']('‚úÖ\x20Logs\x20cleaned');}catch(b){console['error']('Clean\x20logs\x20error:',b);}}function adminUI(){const a='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Quantum\x20Shield\x20Admin</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20font-family:\x20system-ui,\x20-apple-system,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#667eea\x200%,\x20#764ba2\x20100%);\x0a\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20\x20\x20padding:\x2020px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x2020px;\x0a\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2020px\x2060px\x20rgba(0,0,0,0.3);\x0a\x20\x20\x20\x20\x20\x20max-width:\x20500px;\x0a\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20padding:\x2040px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20h1\x20{\x0a\x20\x20\x20\x20\x20\x20color:\x20#667eea;\x0a\x20\x20\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20\x20\x20font-size:\x202rem;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.version\x20{\x0a\x20\x20\x20\x20\x20\x20color:\x20#999;\x0a\x20\x20\x20\x20\x20\x20margin-bottom:\x2030px;\x0a\x20\x20\x20\x20\x20\x20font-size:\x200.9rem;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.form-group\x20{\x0a\x20\x20\x20\x20\x20\x20margin-bottom:\x2020px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20label\x20{\x0a\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20\x20\x20margin-bottom:\x208px;\x0a\x20\x20\x20\x20\x20\x20color:\x20#333;\x0a\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20input\x20{\x0a\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20padding:\x2012px;\x0a\x20\x20\x20\x20\x20\x20border:\x202px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20font-size:\x201rem;\x0a\x20\x20\x20\x20\x20\x20transition:\x20border-color\x200.3s;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20input:focus\x20{\x0a\x20\x20\x20\x20\x20\x20outline:\x20none;\x0a\x20\x20\x20\x20\x20\x20border-color:\x20#667eea;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20button\x20{\x0a\x20\x20\x20\x20\x20\x20width:\x20100%;\x0a\x20\x20\x20\x20\x20\x20padding:\x2014px;\x0a\x20\x20\x20\x20\x20\x20background:\x20linear-gradient(135deg,\x20#667eea\x200%,\x20#764ba2\x20100%);\x0a\x20\x20\x20\x20\x20\x20color:\x20white;\x0a\x20\x20\x20\x20\x20\x20border:\x20none;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20font-size:\x201rem;\x0a\x20\x20\x20\x20\x20\x20font-weight:\x20600;\x0a\x20\x20\x20\x20\x20\x20cursor:\x20pointer;\x0a\x20\x20\x20\x20\x20\x20transition:\x20transform\x200.2s;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20button:hover\x20{\x0a\x20\x20\x20\x20\x20\x20transform:\x20translateY(-2px);\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20button:disabled\x20{\x0a\x20\x20\x20\x20\x20\x20opacity:\x200.6;\x0a\x20\x20\x20\x20\x20\x20cursor:\x20not-allowed;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.message\x20{\x0a\x20\x20\x20\x20\x20\x20margin-top:\x2020px;\x0a\x20\x20\x20\x20\x20\x20padding:\x2015px;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x208px;\x0a\x20\x20\x20\x20\x20\x20display:\x20none;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.message.success\x20{\x0a\x20\x20\x20\x20\x20\x20background:\x20#d4edda;\x0a\x20\x20\x20\x20\x20\x20color:\x20#155724;\x0a\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.message.error\x20{\x0a\x20\x20\x20\x20\x20\x20background:\x20#f8d7da;\x0a\x20\x20\x20\x20\x20\x20color:\x20#721c24;\x0a\x20\x20\x20\x20\x20\x20display:\x20block;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.features\x20{\x0a\x20\x20\x20\x20\x20\x20margin-top:\x2030px;\x0a\x20\x20\x20\x20\x20\x20padding-top:\x2030px;\x0a\x20\x20\x20\x20\x20\x20border-top:\x201px\x20solid\x20#e0e0e0;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.feature\x20{\x0a\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20gap:\x2010px;\x0a\x20\x20\x20\x20\x20\x20padding:\x208px\x200;\x0a\x20\x20\x20\x20\x20\x20color:\x20#666;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.feature::before\x20{\x0a\x20\x20\x20\x20\x20\x20content:\x20\x22‚úì\x22;\x0a\x20\x20\x20\x20\x20\x20color:\x20#667eea;\x0a\x20\x20\x20\x20\x20\x20font-weight:\x20bold;\x0a\x20\x20\x20\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<h1>üöÄ\x20Quantum\x20Shield</h1>\x0a\x20\x20\x20\x20<div\x20class=\x22version\x22>Version\x20'+CONFIG['VERSION']+'</div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<form\x20id=\x22loginForm\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22username\x22>Username</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22username\x22\x20required\x20autocomplete=\x22username\x22>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<label\x20for=\x22password\x22>Password</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20id=\x22password\x22\x20required\x20autocomplete=\x22current-password\x22>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20id=\x22submitBtn\x22>Login</button>\x0a\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22message\x22\x20id=\x22message\x22></div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22features\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>Quantum\x20Encryption</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>Smart\x20Traffic\x20Buffering</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>Fragment\x20&\x20Padding</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>TLS\x20Randomization</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>Multi-Path\x20Routing</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>Zero\x20Write\x20Limitation</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x20\x20\x0a\x20\x20<script>\x0a\x20\x20\x20\x20const\x20form\x20=\x20document.getElementById(\x27loginForm\x27);\x0a\x20\x20\x20\x20const\x20btn\x20=\x20document.getElementById(\x27submitBtn\x27);\x0a\x20\x20\x20\x20const\x20msg\x20=\x20document.getElementById(\x27message\x27);\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20form.addEventListener(\x27submit\x27,\x20async\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20btn.disabled\x20=\x20true;\x0a\x20\x20\x20\x20\x20\x20btn.textContent\x20=\x20\x27Logging\x20in...\x27;\x0a\x20\x20\x20\x20\x20\x20msg.className\x20=\x20\x27message\x27;\x0a\x20\x20\x20\x20\x20\x20msg.textContent\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20const\x20data\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20username:\x20document.getElementById(\x27username\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20password:\x20document.getElementById(\x27password\x27).value\x0a\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20res\x20=\x20await\x20fetch(\x27/admin-login\x27,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27POST\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body:\x20JSON.stringify(data)\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20result\x20=\x20await\x20res.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(result.success)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msg.className\x20=\x20\x27message\x20success\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msg.textContent\x20=\x20\x27‚úÖ\x20Login\x20successful!\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localStorage.setItem(\x27token\x27,\x20result.token);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20window.location.href\x20=\x20\x27/api/v3/users\x27,\x201500);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msg.className\x20=\x20\x27message\x20error\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20msg.textContent\x20=\x20\x27‚ùå\x20\x27\x20+\x20(result.error\x20||\x20\x27Login\x20failed\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20msg.className\x20=\x20\x27message\x20error\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20msg.textContent\x20=\x20\x27‚ùå\x20Connection\x20error\x27;\x0a\x20\x20\x20\x20\x20\x20}\x20finally\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20btn.disabled\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20btn.textContent\x20=\x20\x27Login\x27;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x20\x20</script>\x0a</body>\x0a</html>';return new Response(a,{'headers':{'Content-Type':'text/html;\x20charset=utf-8',...sec()}});}function fake(){const a='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20<title>Welcome</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20font-family:\x20system-ui,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20background:\x20#f5f5f5;\x0a\x20\x20\x20\x20\x20\x20min-height:\x20100vh;\x0a\x20\x20\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20\x20\x20align-items:\x20center;\x0a\x20\x20\x20\x20\x20\x20justify-content:\x20center;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.container\x20{\x0a\x20\x20\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20\x20\x20padding:\x2060px\x2040px;\x0a\x20\x20\x20\x20\x20\x20background:\x20white;\x0a\x20\x20\x20\x20\x20\x20border-radius:\x2015px;\x0a\x20\x20\x20\x20\x20\x20box-shadow:\x200\x2010px\x2040px\x20rgba(0,0,0,0.1);\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20h1\x20{\x20font-size:\x202.5rem;\x20color:\x20#333;\x20margin-bottom:\x2020px;\x20}\x0a\x20\x20\x20\x20p\x20{\x20font-size:\x201.1rem;\x20color:\x20#666;\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<h1>üëã\x20Welcome</h1>\x0a\x20\x20\x20\x20<p>This\x20is\x20a\x20standard\x20web\x20service.</p>\x0a\x20\x20</div>\x0a</body>\x0a</html>';return new Response(a,{'headers':{'Content-Type':'text/html;\x20charset=utf-8',...sec()}});}function getIP(a){return a['headers']['get']('CF-Connecting-IP')||a['headers']['get']('X-Real-IP')||'unknown';}function sec(){return{'X-Content-Type-Options':'nosniff','X-Frame-Options':'DENY','X-XSS-Protection':'1;\x20mode=block','Referrer-Policy':'no-referrer'};}function cors(){return{'Access-Control-Allow-Origin':'*','Access-Control-Allow-Methods':'GET,\x20POST,\x20PUT,\x20DELETE,\x20OPTIONS','Access-Control-Allow-Headers':'Content-Type,\x20Authorization'};}function json(a,b=0xc8){return new Response(JSON['stringify'](a,null,0x2),{'status':b,'headers':{'Content-Type':'application/json',...sec(),...cors()}});}function pickSNI(){return CONFIG['SNI'][Math['floor'](Math['random']()*CONFIG['SNI']['length'])];}function validUUID(a){return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i['test'](a);}function genUUID(){return'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'['replace'](/[xy]/g,a=>{const b=Math['random']()*0x10|0x0,d=a==='x'?b:b&0x3|0x8;return d['toString'](0x10);});}function token(a){const b=new Uint8Array(a);return crypto['getRandomValues'](b),Array['from'](b,c=>c['toString'](0x10)['padStart'](0x2,'0'))['join']('');}function toUUID(a){const b=Array['from'](a,c=>c['toString'](0x10)['padStart'](0x2,'0'))['join']('');return b['substring'](0x0,0x8)+'-'+b['substring'](0x8,0xc)+'-'+b['substring'](0xc,0x10)+'-'+b['substring'](0x10,0x14)+'-'+b['substring'](0x14,0x20);}function concat(...a){const b=a['reduce']((e,f)=>e+f['length'],0x0),c=new Uint8Array(b);let d=0x0;for(const e of a){c['set'](e,d),d+=e['length'];}return c;}function sleep(a){return new Promise(b=>setTimeout(b,a));}async function delay(){const a=Math['floor'](Math['random']()*CONFIG['QUANTUM']['JITTER_MS']);if(a>0x0)await sleep(a);}async function log(a,b,c,d){try{if(!a['QUANTUM_DB'])return;await a['QUANTUM_DB']['prepare']('INSERT\x20INTO\x20logs\x20(type,\x20user_id,\x20ip_address,\x20message)\x20VALUES\x20(?,\x20?,\x20?,\x20?)')['bind'](b,c,d,'Event:\x20'+b)['run']();}catch(e){console['error']('Log\x20error:',e);}}async function logErr(a,b,c){try{if(!a['QUANTUM_DB'])return;await a['QUANTUM_DB']['prepare']('INSERT\x20INTO\x20logs\x20(type,\x20message)\x20VALUES\x20(?,\x20?)')['bind']('error',c+':\x20'+b['message'])['run']();}catch(d){console['error']('Log\x20error\x20failed:',d);}}