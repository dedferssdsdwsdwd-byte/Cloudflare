// <!--GAMFC-->version base on commit: 65a2477f07d2b1187af12c8d3e9638514eaea68e - last update: 2025-12-22 01:04:26 UTC <!--GAMFC-END-->.

import{connect}from'cloudflare:sockets';const CONST={'VERSION':'3.1.0','HEALTH_CHECK_TIMEOUT':0x7d0,'DNS_CACHE_TTL':0x12c,'MAX_REQUEST_SIZE':0x400*0x400,'RATE_LIMIT_WINDOW':0x3c,'LOGIN_FAIL_LIMIT':0x5,'DEFAULT_PORT':0x1bb,'BUFFER_SIZE':0x2000,'SALT_ROUNDS':0xa,'TOKEN_EXPIRY':0x15180},Config={'defaultUUID':'d342d11e-d424-4583-b36e-524ab1f0afa4','fromEnv'(a){return{'uuid':a['UUID']||this['defaultUUID'],'adminKey':a['ADMIN_KEY']||'','adminPath':a['ADMIN_PATH']||'admin','proxyIPs':(a['PROXYIP']||'')['split'](',')['filter'](Boolean)['map'](b=>b['trim']()),'socks5':{'address':a['SOCKS5']||'','enabled':!!a['SOCKS5']},'enableLandingProxy':a['ENABLE_LANDING_PROXY']==='true','landingPageUrl':a['LANDING_PAGE_URL']||'https://www.google.com','scamalytics':{'key':a['SCAMALYTICS_API_KEY'],'user':a['SCAMALYTICS_USERNAME'],'threshold':parseInt(a['SCAMALYTICS_THRESHOLD']||'100')},'DB':a['DB']};}},Database={async 'init'(a){if(!a['DB']){console['warn']('⚠️\x20D1\x20Database\x20binding\x20(DB)\x20not\x20found.\x20Skipping\x20DB\x20init.');return;}const b=['CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20users\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20email\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20created_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_date\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_time\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20traffic_used\x20INTEGER\x20DEFAULT\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ip_limit\x20INTEGER\x20DEFAULT\x20-1,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20active\x20INTEGER\x20DEFAULT\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20system_config\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20key\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20value\x20TEXT,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updated_at\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)','CREATE\x20TABLE\x20IF\x20NOT\x20EXISTS\x20proxy_health\x20(\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20address\x20TEXT\x20PRIMARY\x20KEY,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20latency\x20INTEGER,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20last_check\x20DATETIME\x20DEFAULT\x20CURRENT_TIMESTAMP,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20is_healthy\x20INTEGER\x20DEFAULT\x201\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20)'];try{const c=b['map'](f=>a['DB']['prepare'](f));await a['DB']['batch'](c);const d=await a['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')['first']('count');if(d===0x0){const f=Config['fromEnv'](a);await a['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20notes,\x20traffic_limit)\x20VALUES\x20(?,\x20?,\x20?)')['bind'](f['uuid'],'Default\x20Admin\x20User',0x0)['run']();}}catch(g){console['error']('Database\x20initialization\x20failed:',g);}},async 'getUser'(a,b){if(!a)return null;try{return await a['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();}catch(c){return console['error']('getUser\x20failed:',c),null;}},async 'getAllUsers'(a){if(!a)return[];try{return await a['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();}catch(b){return console['error']('getAllUsers\x20failed:',b),[];}},async 'updateUserTraffic'(a,b,c){if(!a)return;try{await a['prepare']('UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](c,b)['run']();}catch(d){console['error']('Traffic\x20Update\x20Error:',d);}},async 'saveProxyHealth'(a,b,c,d){if(!a)return;try{await a['prepare']('INSERT\x20OR\x20REPLACE\x20INTO\x20proxy_health\x20(address,\x20latency,\x20is_healthy,\x20last_check)\x20VALUES\x20(?,\x20?,\x20?,\x20CURRENT_TIMESTAMP)')['bind'](b,c,d?0x1:0x0)['run']();}catch(f){console['error']('Health\x20Save\x20Error:',f);}}},Utils={'base64Encode'(a){const b=new TextEncoder(),c=b['encode'](a);let d='';for(let e=0x0;e<c['length'];e++){d+=String['fromCharCode'](c[e]);}return btoa(d)['replace'](/\+/g,'-')['replace'](/\//g,'_')['replace'](/=+$/,'');},'isValidUUID'(a){const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);},'addSecurityHeaders'(a){a['set']('Strict-Transport-Security','max-age=63072000;\x20includeSubDomains;\x20preload'),a['set']('X-Content-Type-Options','nosniff'),a['set']('X-Frame-Options','DENY'),a['set']('Referrer-Policy','strict-origin-when-cross-origin'),a['set']('Permissions-Policy','camera=(),\x20microphone=(),\x20usb=()'),a['set']('Alt-Svc','h3=\x22:443\x22;\x20ma=86400,\x20h3-29=\x22:443\x22;\x20ma=86400');},'generateNonce'(){let a='';const b='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';for(let c=0x0;c<0x10;c++){a+=b['charAt'](Math['floor'](Math['random']()*b['length']));}return a;}},ASSETS={'CSS':'\x0a\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20--bg-body:\x20#0f172a;\x20--bg-card:\x20#1e293b;\x20--bg-input:\x20#334155;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--text-main:\x20#f8fafc;\x20--text-muted:\x20#94a3b8;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--primary:\x20#3b82f6;\x20--primary-hover:\x20#2563eb;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--success:\x20#10b981;\x20--danger:\x20#ef4444;\x20--warning:\x20#f59e0b;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--border:\x20#334155;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20*\x20{\x20box-sizing:\x20border-box;\x20margin:\x200;\x20padding:\x200;\x20outline:\x20none;\x20}\x0a\x20\x20\x20\x20body\x20{\x20font-family:\x20\x27Inter\x27,\x20system-ui,\x20sans-serif;\x20background-color:\x20var(--bg-body);\x20color:\x20var(--text-main);\x20min-height:\x20100vh;\x20}\x0a\x20\x20\x20\x20.container\x20{\x20max-width:\x201200px;\x20margin:\x200\x20auto;\x20padding:\x2020px;\x20}\x0a\x20\x20\x20\x20.flex\x20{\x20display:\x20flex;\x20}\x20.flex-col\x20{\x20flex-direction:\x20column;\x20}\x20.items-center\x20{\x20align-items:\x20center;\x20}\x20.justify-between\x20{\x20justify-content:\x20space-between;\x20}\x0a\x20\x20\x20\x20.gap-2\x20{\x20gap:\x200.5rem;\x20}\x20.gap-4\x20{\x20gap:\x201rem;\x20}\x20.w-full\x20{\x20width:\x20100%;\x20}\x20.hidden\x20{\x20display:\x20none;\x20}\x0a\x20\x20\x20\x20.grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(280px,\x201fr));\x20gap:\x201.5rem;\x20}\x0a\x20\x20\x20\x20.card\x20{\x20background-color:\x20var(--bg-card);\x20border:\x201px\x20solid\x20var(--border);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20box-shadow:\x200\x204px\x206px\x20-1px\x20rgba(0,0,0,0.1);\x20}\x0a\x20\x20\x20\x20.btn\x20{\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20padding:\x200.5rem\x201rem;\x20border-radius:\x208px;\x20cursor:\x20pointer;\x20border:\x20none;\x20gap:\x200.5rem;\x20font-weight:\x20500;\x20font-size:\x200.875rem;\x20transition:\x20all\x200.2s;\x20}\x0a\x20\x20\x20\x20.btn-primary\x20{\x20background-color:\x20var(--primary);\x20color:\x20white;\x20}\x20.btn-primary:hover\x20{\x20background-color:\x20var(--primary-hover);\x20}\x0a\x20\x20\x20\x20.btn-danger\x20{\x20background-color:\x20rgba(239,\x2068,\x2068,\x200.1);\x20color:\x20var(--danger);\x20border:\x201px\x20solid\x20rgba(239,\x2068,\x2068,\x200.2);\x20}\x0a\x20\x20\x20\x20.btn-ghost\x20{\x20background:\x20transparent;\x20color:\x20var(--text-muted);\x20}\x20.btn-ghost:hover\x20{\x20color:\x20var(--text-main);\x20background:\x20rgba(255,255,255,0.05);\x20}\x0a\x20\x20\x20\x20.input\x20{\x20width:\x20100%;\x20background-color:\x20var(--bg-body);\x20border:\x201px\x20solid\x20var(--border);\x20color:\x20var(--text-main);\x20padding:\x200.625rem;\x20border-radius:\x208px;\x20font-size:\x200.875rem;\x20}\x0a\x20\x20\x20\x20.input:focus\x20{\x20border-color:\x20var(--primary);\x20}\x0a\x20\x20\x20\x20.table-container\x20{\x20overflow-x:\x20auto;\x20border-radius:\x208px;\x20border:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20table\x20{\x20width:\x20100%;\x20border-collapse:\x20collapse;\x20text-align:\x20left;\x20}\x0a\x20\x20\x20\x20th\x20{\x20background-color:\x20rgba(0,0,0,0.2);\x20padding:\x2012px\x2016px;\x20font-size:\x200.75rem;\x20text-transform:\x20uppercase;\x20color:\x20var(--text-muted);\x20}\x0a\x20\x20\x20\x20td\x20{\x20padding:\x2016px;\x20border-top:\x201px\x20solid\x20var(--border);\x20font-size:\x200.875rem;\x20}\x0a\x20\x20\x20\x20.toast\x20{\x20position:\x20fixed;\x20bottom:\x2020px;\x20right:\x2020px;\x20background:\x20var(--bg-card);\x20border:\x201px\x20solid\x20var(--border);\x20padding:\x201rem;\x20border-radius:\x208px;\x20transform:\x20translateY(100px);\x20opacity:\x200;\x20transition:\x20all\x200.3s;\x20z-index:\x201000;\x20}\x0a\x20\x20\x20\x20.toast.show\x20{\x20transform:\x20translateY(0);\x20opacity:\x201;\x20}\x0a\x20\x20\x20\x20.toast.success\x20{\x20border-left:\x204px\x20solid\x20var(--success);\x20}\x0a\x20\x20\x20\x20.toast.error\x20{\x20border-left:\x204px\x20solid\x20var(--danger);\x20}\x0a\x20\x20\x20\x20.badge\x20{\x20padding:\x202px\x208px;\x20border-radius:\x2099px;\x20font-size:\x200.7rem;\x20font-weight:\x20600;\x20}\x0a\x20\x20\x20\x20.badge-success\x20{\x20background:\x20rgba(16,\x20185,\x20129,\x200.1);\x20color:\x20var(--success);\x20border:\x201px\x20solid\x20rgba(16,\x20185,\x20129,\x200.2);\x20}\x0a\x20\x20\x20\x20.badge-warning\x20{\x20background:\x20rgba(245,\x20158,\x2011,\x200.1);\x20color:\x20var(--warning);\x20border:\x201px\x20solid\x20rgba(245,\x20158,\x2011,\x200.2);\x20}\x0a\x20\x20\x20\x20.login-wrapper\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20min-height:\x20100vh;\x20background:\x20radial-gradient(circle\x20at\x20center,\x20#1e293b\x200%,\x20#0f172a\x20100%);\x20}\x0a\x20\x20\x20\x20.login-card\x20{\x20width:\x20100%;\x20max-width:\x20400px;\x20}\x0a\x20\x20\x20\x20@keyframes\x20fadeIn\x20{\x20from\x20{\x20opacity:\x200;\x20transform:\x20translateY(10px);\x20}\x20to\x20{\x20opacity:\x201;\x20transform:\x20translateY(0);\x20}\x20}\x0a\x20\x20\x20\x20.animate-fade\x20{\x20animation:\x20fadeIn\x200.4s\x20ease-out\x20forwards;\x20}\x0a\x20\x20\x20\x20','ICONS':{'DASHBOARD':'<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x2214\x22\x20y=\x223\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x2214\x22\x20y=\x2214\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x223\x22\x20y=\x2214\x22\x20width=\x227\x22\x20height=\x227\x22/></svg>','USERS':'<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><path\x20d=\x22M17\x2021v-2a4\x204\x200\x200\x200-4-4H5a4\x204\x200\x200\x200-4\x204v2\x22/><circle\x20cx=\x229\x22\x20cy=\x227\x22\x20r=\x224\x22/><path\x20d=\x22M23\x2021v-2a4\x204\x200\x200\x200-3-3.87\x22/><path\x20d=\x22M16\x203.13a4\x204\x200\x200\x201\x200\x207.75\x22/></svg>','SETTINGS':'<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><circle\x20cx=\x2212\x22\x20cy=\x2212\x22\x20r=\x223\x22/><path\x20d=\x22M19.4\x2015a1.65\x201.65\x200\x200\x200\x20.33\x201.82l.06.06a2\x202\x200\x200\x201\x200\x202.83\x202\x202\x200\x200\x201-2.83\x200l-.06-.06a1.65\x201.65\x200\x200\x200-1.82-.33\x201.65\x201.65\x200\x200\x200-1\x201.51V21a2\x202\x200\x200\x201-2\x202\x202\x202\x200\x200\x201-2-2v-.09A1.65\x201.65\x200\x200\x200\x209\x2019.4a1.65\x201.65\x200\x200\x200-1.82.33l-.06.06a2\x202\x200\x200\x201-2.83\x200\x202\x202\x200\x200\x201\x200-2.83l.06-.06a1.65\x201.65\x200\x200\x200\x20.33-1.82\x201.65\x201.65\x200\x200\x200-1.51-1H3a2\x202\x200\x200\x201-2-2\x202\x202\x200\x200\x201\x202-2h.09A1.65\x201.65\x200\x200\x200\x204.6\x209a1.65\x201.65\x200\x200\x200-.33-1.82l-.06-.06a2\x202\x200\x200\x201\x200-2.83\x202\x202\x200\x200\x201\x202.83\x200l.06.06a1.65\x201.65\x200\x200\x200\x201.82.33H9a1.65\x201.65\x200\x200\x200\x201-1.51V3a2\x202\x200\x200\x201\x202-2\x202\x202\x200\x200\x201\x202\x202v.09a1.65\x201.65\x200\x200\x200\x201\x201.51\x201.65\x201.65\x200\x200\x200\x201.82-.33l.06-.06a2\x202\x200\x200\x201\x202.83\x200\x202\x202\x200\x200\x201\x200\x202.83l-.06.06a1.65\x201.65\x200\x200\x200-.33\x201.82V9a1.65\x201.65\x200\x200\x200\x201.51\x201H21a2\x202\x200\x200\x201\x202\x202\x202\x202\x200\x200\x201-2\x202h-.09a1.65\x201.65\x200\x200\x200-1.51\x201z\x22/></svg>','LOGOUT':'<svg\x20width=\x2220\x22\x20height=\x2220\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><path\x20d=\x22M9\x2021H5a2\x202\x200\x200\x201-2-2V5a2\x202\x200\x200\x201\x202-2h4\x22/><polyline\x20points=\x2216\x2017\x2021\x2012\x2016\x207\x22/><line\x20x1=\x2221\x22\x20y1=\x2212\x22\x20x2=\x229\x22\x20y2=\x2212\x22/></svg>','COPY':'<svg\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><rect\x20x=\x229\x22\x20y=\x229\x22\x20width=\x2213\x22\x20height=\x2213\x22\x20rx=\x222\x22\x20ry=\x222\x22/><path\x20d=\x22M5\x2015H4a2\x202\x200\x200\x201-2-2V4a2\x202\x200\x200\x201\x202-2h9a2\x202\x200\x200\x201\x202\x202v1\x22/></svg>','QR':'<svg\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><rect\x20x=\x223\x22\x20y=\x223\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x2214\x22\x20y=\x223\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x2214\x22\x20y=\x2214\x22\x20width=\x227\x22\x20height=\x227\x22/><rect\x20x=\x223\x22\x20y=\x2214\x22\x20width=\x227\x22\x20height=\x227\x22/><path\x20d=\x22M10\x2010h.01\x22/><path\x20d=\x22M14\x2014h.01\x22/><path\x20d=\x22M10\x2014h.01\x22/><path\x20d=\x22M14\x2010h.01\x22/></svg>','REFRESH':'<svg\x20width=\x2216\x22\x20height=\x2216\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20fill=\x22none\x22\x20stroke=\x22currentColor\x22\x20stroke-width=\x222\x22><polyline\x20points=\x2223\x204\x2023\x2010\x2017\x2010\x22/><polyline\x20points=\x221\x2020\x201\x2014\x207\x2014\x22/><path\x20d=\x22M3.51\x209a9\x209\x200\x200\x201\x2014.85-3.36L23\x2010M1\x2014l4.64\x204.36A9\x209\x200\x200\x200\x2020.49\x2015\x22/></svg>'}};function buildAdminUI(a,b){return'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>VLESS\x20Manager\x20|\x20Admin</title>\x0a\x20\x20\x20\x20<style\x20nonce=\x22'+b+'\x22>'+ASSETS['CSS']+'</style>\x0a\x20\x20\x20\x20<script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22\x20integrity=\x22sha512-CNgIRecGo7nphbeZ04Sc13ka07paqdeTu0WR1IM4kNcpmBAUSHSQX0FslNhTDadL4O5SAGapGt4FodqL8My0mA==\x22\x20crossorigin=\x22anonymous\x22\x20referrerpolicy=\x22no-referrer\x22></script>\x0a</head>\x0a<body\x20class=\x22bg-body\x20text-main\x22>\x0a\x20\x20\x20\x20<div\x20id=\x22app\x22\x20class=\x22flex\x20h-screen\x20overflow-hidden\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<aside\x20class=\x22w-64\x20bg-card\x20h-full\x20fixed\x20md:static\x20transform\x20-translate-x-full\x20md:translate-x-0\x20transition-transform\x20duration-200\x20border-r\x20border-border\x20z-30\x20flex\x20flex-col\x22\x20id=\x22sidebar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-6\x20border-b\x20border-border\x20flex\x20items-center\x20justify-between\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h1\x20class=\x22text-xl\x20font-bold\x20flex\x20items-center\x20gap-2\x20m-0\x22><span\x20class=\x22text-primary\x22>⚡</span>\x20VLESS<span\x20class=\x22text-muted\x22>PRO</span></h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22md:hidden\x20text-muted\x22\x20onclick=\x22toggleSidebar()\x22>✕</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<nav\x20class=\x22flex-1\x20p-4\x20space-y-2\x20overflow-y-auto\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22router(\x27dashboard\x27)\x22\x20class=\x22w-full\x20btn\x20btn-ghost\x20justify-start\x20active\x22\x20id=\x22nav-dashboard\x22>'+ASSETS['ICONS']['DASHBOARD']+'\x20Dashboard</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22router(\x27users\x27)\x22\x20class=\x22w-full\x20btn\x20btn-ghost\x20justify-start\x22\x20id=\x22nav-users\x22>'+ASSETS['ICONS']['USERS']+'\x20User\x20Management</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22router(\x27settings\x27)\x22\x20class=\x22w-full\x20btn\x20btn-ghost\x20justify-start\x22\x20id=\x22nav-settings\x22>'+ASSETS['ICONS']['SETTINGS']+'\x20Settings</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</nav>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22p-4\x20border-t\x20border-border\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22logout()\x22\x20class=\x22w-full\x20btn\x20btn-danger\x20justify-start\x20text-sm\x22>'+ASSETS['ICONS']['LOGOUT']+'\x20Sign\x20Out</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</aside>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<main\x20class=\x22flex-1\x20h-full\x20overflow-y-auto\x20relative\x20w-full\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<header\x20class=\x22md:hidden\x20h-16\x20border-b\x20border-border\x20flex\x20items-center\x20justify-between\x20px-4\x20bg-card\x20sticky\x20top-0\x20z-20\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22font-bold\x20text-lg\x22>Dashboard</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22toggleSidebar()\x22\x20class=\x22btn\x20btn-ghost\x20p-2\x22><svg\x20width=\x2224\x22\x20height=\x2224\x22\x20viewBox=\x220\x200\x2024\x2024\x22\x20stroke=\x22currentColor\x22><path\x20stroke-linecap=\x22round\x22\x20stroke-linejoin=\x22round\x22\x20stroke-width=\x222\x22\x20d=\x22M4\x206h16M4\x2012h16M4\x2018h16\x22/></svg></button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</header>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22container\x20py-8\x20px-4\x20md:px-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20flex-col\x20md:flex-row\x20md:items-center\x20justify-between\x20gap-4\x20mb-8\x20animate-fade\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div><h2\x20class=\x22text-2xl\x20font-bold\x22\x20id=\x22page-title\x22>Overview</h2></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20items-center\x20gap-3\x22><button\x20onclick=\x22refreshData()\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20bg-card\x22>'+ASSETS['ICONS']['REFRESH']+'\x20Refresh</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22view-dashboard\x22\x20class=\x22view-section\x20animate-fade\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x20grid-cols-1\x20md:grid-cols-2\x20lg:grid-cols-4\x20gap-6\x20mb-8\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22><p\x20class=\x22text-sm\x20text-muted\x20font-medium\x20uppercase\x22>Total\x20Users</p><h3\x20class=\x22text-3xl\x20font-bold\x20mt-2\x22\x20id=\x22stat-total-users\x22>0</h3></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22><p\x20class=\x22text-sm\x20text-muted\x20font-medium\x20uppercase\x22>Traffic</p><h3\x20class=\x22text-3xl\x20font-bold\x20mt-2\x20text-primary\x22\x20id=\x22stat-total-traffic\x22>0\x20B</h3></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22view-users\x22\x20class=\x22view-section\x20hidden\x20animate-fade\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20items-center\x20mb-6\x22><h3\x20class=\x22text-lg\x20font-bold\x22>Users</h3><button\x20onclick=\x22openModal(\x27create\x27)\x22\x20class=\x22btn\x20btn-primary\x22>+\x20New\x20User</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22table-container\x22><table\x20class=\x22w-full\x22><thead><tr><th>Status</th><th>Details</th><th>Traffic</th><th>Actions</th></tr></thead><tbody\x20id=\x22user-table-body\x22></tbody></table></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22view-settings\x22\x20class=\x22view-section\x20hidden\x20animate-fade\x22><div\x20class=\x22card\x22><h3\x20class=\x22text-lg\x20font-bold\x22>Config</h3><p>Admin\x20Path:\x20/'+a['adminPath']+'</p></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</main>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22modal-create\x22\x20class=\x22fixed\x20inset-0\x20bg-black/80\x20z-50\x20hidden\x20backdrop-blur-sm\x20flex\x20items-center\x20justify-center\x20p-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20w-full\x20max-w-lg\x20relative\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22text-xl\x20font-bold\x20mb-4\x22>New\x20User</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22create-user-form\x22\x20onsubmit=\x22event.preventDefault();\x20saveUser();\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22new-note\x22\x20class=\x22input\x20mb-4\x22\x20placeholder=\x22Name\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-end\x20gap-3\x22><button\x20type=\x22button\x22\x20onclick=\x22closeModal(\x27create\x27)\x22\x20class=\x22btn\x20btn-ghost\x22>Cancel</button><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22modal-qr\x22\x20class=\x22fixed\x20inset-0\x20bg-black/90\x20z-50\x20hidden\x20backdrop-blur-sm\x20flex\x20items-center\x20justify-center\x20p-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20w-full\x20max-w-sm\x20relative\x20text-center\x22\x20onclick=\x22event.stopPropagation()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22closeModal(\x27qr\x27)\x22\x20class=\x22absolute\x20top-4\x20right-4\x20text-muted\x20text-xl\x22>&times;</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22bg-white\x20p-4\x20rounded-xl\x20inline-block\x20mb-6\x22><div\x20id=\x22admin-qr-target\x22></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22copyToClip(window.currentQRLink)\x22\x20class=\x22btn\x20btn-primary\x20w-full\x22>'+ASSETS['ICONS']['COPY']+'\x20Copy\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22\x20class=\x22toast\x22></div>\x0a\x20\x20\x20\x20<script\x20nonce=\x22'+b+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20let\x20users\x20=\x20[];\x0a\x20\x20\x20\x20\x20\x20\x20\x20window.currentQRLink\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20router(view)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.querySelectorAll(\x27.view-section\x27).forEach(el\x20=>\x20el.classList.add(\x27hidden\x27));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27view-\x27\x20+\x20view).classList.remove(\x27hidden\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(view\x20===\x20\x27users\x27)\x20fetchUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20toggleSidebar()\x20{\x20document.getElementById(\x27sidebar\x27).classList.toggle(\x27-translate-x-full\x27);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20fetchStats()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20res\x20=\x20await\x20fetch(\x27?action=get_stats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20data\x20=\x20await\x20res.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27stat-total-users\x27).innerText\x20=\x20data.total;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27stat-total-traffic\x27).innerText\x20=\x20formatBytes(data.traffic);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20fetchUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20res\x20=\x20await\x20fetch(\x27?action=get_users\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20users\x20=\x20await\x20res.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20tbody\x20=\x20document.getElementById(\x27user-table-body\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tbody.innerHTML\x20=\x20users.map(u\x20=>\x20`<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${u.active\x20?\x20\x27<span\x20class=\x22badge\x20badge-success\x22>Active</span>\x27\x20:\x20\x27<span\x20class=\x22badge\x20badge-warning\x22>Inactive</span>\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${u.notes}<div\x20class=\x22text-xs\x20text-muted\x22>${u.uuid}</div></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${formatBytes(u.traffic_used)}\x20/\x20${u.traffic_limit\x20?\x20formatBytes(u.traffic_limit)\x20:\x20\x27∞\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><button\x20onclick=\x22showQR(\x27${u.uuid}\x27)\x22\x20class=\x22btn\x20btn-ghost\x20text-primary\x22>'+ASSETS['ICONS']['QR']+'</button><button\x20onclick=\x22deleteUser(\x27${u.uuid}\x27)\x22\x20class=\x22btn\x20btn-ghost\x20text-danger\x22>✕</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>`).join(\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch(e)\x20{}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20saveUser()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20note\x20=\x20document.getElementById(\x27new-note\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetch(\x27?action=create_user\x27,\x20{\x20method:\x20\x27POST\x27,\x20body:\x20JSON.stringify({\x20note,\x20traffic_limit:\x200\x20})\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20closeModal(\x27create\x27);\x20fetchUsers();\x20fetchStats();\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20deleteUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(confirm(\x27Delete\x20user?\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetch(\x27?action=delete_user\x27,\x20{\x20method:\x20\x27POST\x27,\x20body:\x20JSON.stringify({\x20uuid\x20})\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fetchUsers();\x20fetchStats();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20generateLink(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20host\x20=\x20window.location.hostname;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`vless://${uuid}@${host}:443?encryption=none&security=tls&type=ws&host=${host}&path=%2F#${host}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20showQR(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window.currentQRLink\x20=\x20generateLink(uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27admin-qr-target\x27).innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20new\x20QRCode(document.getElementById(\x27admin-qr-target\x27),\x20{\x20text:\x20window.currentQRLink,\x20width:\x20200,\x20height:\x20200\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20openModal(\x27qr\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20copyToClip(str)\x20{\x20navigator.clipboard.writeText(str);\x20showToast(\x27Copied!\x27,\x20\x27success\x27);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(msg,\x20type)\x20{\x20const\x20t\x20=\x20document.getElementById(\x27toast\x27);\x20t.textContent\x20=\x20msg;\x20t.className\x20=\x20`toast\x20show\x20${type}`;\x20setTimeout(()\x20=>\x20t.classList.remove(\x27show\x27),\x203000);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20openModal(id)\x20{\x20document.getElementById(\x27modal-\x27+id).classList.remove(\x27hidden\x27);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20closeModal(id)\x20{\x20document.getElementById(\x27modal-\x27+id).classList.add(\x27hidden\x27);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20formatBytes(bytes)\x20{\x20if\x20(!+bytes)\x20return\x20\x270\x20B\x27;\x20const\x20k=1024,\x20i=Math.floor(Math.log(bytes)/Math.log(k));\x20return\x20parseFloat((bytes/Math.pow(k,i)).toFixed(2))+\x27\x20\x27+[\x27B\x27,\x27KB\x27,\x27MB\x27,\x27GB\x27,\x27TB\x27][i];\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20refreshData()\x20{\x20fetchStats();\x20if(!document.getElementById(\x27view-users\x27).classList.contains(\x27hidden\x27))\x20fetchUsers();\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20logout()\x20{\x20document.cookie\x20=\x20\x22auth_token=;\x20path=/;\x20expires=Thu,\x2001\x20Jan\x201970\x2000:00:01\x20GMT;\x22;\x20window.location.reload();\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20fetchStats();\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>';}function buildLoginPage(a,b){return'<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Login</title><style>'+ASSETS['CSS']+'</style></head><body>\x0a\x20\x20\x20\x20<div\x20class=\x22login-wrapper\x22><div\x20class=\x22card\x20login-card\x20animate-fade\x22><div\x20class=\x22text-center\x20mb-8\x22><h1\x20class=\x22text-3xl\x20font-bold\x20text-primary\x22>VLESS\x20PRO</h1></div>\x0a\x20\x20\x20\x20'+(b?'<div\x20class=\x22bg-red-500/10\x20text-danger\x20p-3\x20rounded\x20mb-4\x20text-center\x22>'+b+'</div>':'')+'\x0a\x20\x20\x20\x20<form\x20action=\x22/'+a+'\x22\x20method=\x22POST\x22><input\x20type=\x22password\x22\x20name=\x22password\x22\x20class=\x22input\x20text-center\x20text-lg\x20mb-4\x22\x20placeholder=\x22Admin\x20Key\x22\x20required\x20autofocus><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x20w-full\x20py-3\x22>Login</button></form>\x0a\x20\x20\x20\x20</div></div></body></html>';}function buildUserUI(a,b){const c=a['traffic_limit']?(a['traffic_limit']/0x40000000)['toFixed'](0x2):'∞',d=(a['traffic_used']/0x40000000)['toFixed'](0x2),e=a['traffic_limit']>0x0?Math['min'](0x64,a['traffic_used']/a['traffic_limit']*0x64)['toFixed'](0x1):0x0;return'<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Subscription</title><style>'+ASSETS['CSS']+'</style><script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22></script></head><body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x20py-8\x20max-w-2xl\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20mb-8\x20animate-fade\x22><div><h1\x20class=\x22text-2xl\x20font-bold\x22>My\x20Subscription</h1><p\x20class=\x22text-muted\x20text-sm\x22>Active</p></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20mb-6\x20animate-fade\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22flex\x20justify-between\x20items-end\x20mb-4\x22><div><p\x20class=\x22text-sm\x20text-muted\x22>Data\x20Usage</p><h2\x20class=\x22text-3xl\x20font-bold\x22>'+d+'\x20<span\x20class=\x22text-sm\x20font-normal\x22>GB</span></h2></div><div><p\x20class=\x22text-sm\x20text-muted\x22>of\x20'+c+'\x20GB</p></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22w-full\x20bg-border\x20h-4\x20rounded-full\x20overflow-hidden\x22><div\x20class=\x22bg-success\x20h-full\x22\x20style=\x22width:\x20'+e+'%\x22></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20mb-6\x20animate-fade\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20class=\x22font-bold\x20mb-4\x22>Connection\x20Profiles</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x20gap-3\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22copyLink(\x27vless\x27)\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20justify-between\x22><span>VLESS\x20(Universal)</span>'+ASSETS['ICONS']['COPY']+'</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20onclick=\x22openQR()\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20justify-between\x22><span>Show\x20QR\x20Code</span>'+ASSETS['ICONS']['QR']+'</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22grid\x20grid-cols-2\x20gap-3\x22><button\x20onclick=\x22copyLink(\x27clash\x27)\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20text-sm\x22>Copy\x20Clash</button><button\x20onclick=\x22copyLink(\x27singbox\x27)\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20text-sm\x22>Copy\x20Sing-Box</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20animate-fade\x22><h3\x20class=\x22font-bold\x20mb-4\x22>Clients</h3><div\x20class=\x22grid\x20grid-cols-2\x20gap-2\x22><a\x20href=\x22https://play.google.com/store/apps/details?id=com.v2ray.ang\x22\x20target=\x22_blank\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20text-xs\x22>V2RayNG</a><a\x20href=\x22https://github.com/MatsuriDayo/nekoray/releases\x22\x20target=\x22_blank\x22\x20class=\x22btn\x20btn-ghost\x20border\x20border-border\x20text-xs\x22>Nekoray</a></div></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22modal-qr\x22\x20class=\x22fixed\x20inset-0\x20bg-black/90\x20z-50\x20hidden\x20backdrop-blur-sm\x20flex\x20items-center\x20justify-center\x20p-4\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x20w-full\x20max-w-sm\x20relative\x20text-center\x22><button\x20onclick=\x22closeModal()\x22\x20class=\x22absolute\x20top-4\x20right-4\x20text-white\x20text-xl\x22>&times;</button><h3\x20class=\x22font-bold\x20mb-6\x22>Scan</h3><div\x20class=\x22bg-white\x20p-4\x20rounded-xl\x20inline-block\x22><div\x20id=\x22qrcode\x22></div></div></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22\x20class=\x22toast\x22></div>\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20CONFIG\x20=\x20{\x20uuid:\x20\x22'+a['uuid']+'\x22,\x20host:\x20window.location.hostname\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20vlessLink\x20=\x20`vless://${CONFIG.uuid}@${CONFIG.host}:443?encryption=none&security=tls&type=ws&host=${CONFIG.host}&path=%2F#${CONFIG.host}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20new\x20QRCode(document.getElementById(\x22qrcode\x22),\x20{\x20text:\x20vlessLink,\x20width:\x20200,\x20height:\x20200\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20copyLink(type)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20link\x20=\x20vlessLink;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(type\x20===\x20\x27clash\x27)\x20link\x20=\x20location.origin\x20+\x20\x27/sub/\x27\x20+\x20CONFIG.uuid\x20+\x20\x27?format=clash\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if(type\x20===\x20\x27singbox\x27)\x20link\x20=\x20location.origin\x20+\x20\x27/sub/\x27\x20+\x20CONFIG.uuid\x20+\x20\x27?format=singbox\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20navigator.clipboard.writeText(link);\x20showToast();\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast()\x20{\x20const\x20t\x20=\x20document.getElementById(\x27toast\x27);\x20t.textContent\x20=\x20\x27Copied!\x27;\x20t.className\x20=\x20\x27toast\x20show\x20success\x27;\x20setTimeout(()\x20=>\x20t.classList.remove(\x27show\x27),\x202000);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20openQR()\x20{\x20document.getElementById(\x27modal-qr\x27).classList.remove(\x27hidden\x27);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20function\x20closeModal()\x20{\x20document.getElementById(\x27modal-qr\x27).classList.add(\x27hidden\x27);\x20}\x0a\x20\x20\x20\x20</script></body></html>';}async function handleApiRequest(a,b){const c=new URL(a['url']),d=c['searchParams']['get']('action');try{if(d==='get_stats'){const f=await b['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')['first']('count'),g=await b['DB']['prepare']('SELECT\x20SUM(traffic_used)\x20as\x20total\x20FROM\x20users')['first']('total')||0x0;return new Response(JSON['stringify']({'total':f,'active':f,'traffic':g}),{'headers':{'Content-Type':'application/json'}});}if(d==='get_users')return new Response(JSON['stringify'](await Database['getAllUsers'](b['DB'])),{'headers':{'Content-Type':'application/json'}});if(d==='create_user'){const h=await a['json'](),i=crypto['randomUUID']();return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20notes,\x20traffic_limit)\x20VALUES\x20(?,\x20?,\x20?)')['bind'](i,h['note'],h['traffic_limit'])['run'](),new Response(JSON['stringify']({'success':!![]}),{'headers':{'Content-Type':'application/json'}});}if(d==='delete_user'){const j=await a['json']();return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](j['uuid'])['run'](),new Response(JSON['stringify']({'success':!![]}),{'headers':{'Content-Type':'application/json'}});}}catch(k){return new Response(JSON['stringify']({'error':k['message']}),{'status':0x1f4});}}async function vlessOverWSHandler(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();let g='',h='';const i=(q,r)=>console['log']('['+g+':'+h+']\x20'+q,r||''),j=a['headers']['get']('sec-websocket-protocol')||'',{earlyData:k,error:l}=base64ToArrayBuffer(j),m=new ReadableStream({'start'(q){f['addEventListener']('message',r=>{if(r['data'])q['enqueue'](r['data']);}),f['addEventListener']('close',()=>{safeCloseWebSocket(f),q['close']();}),f['addEventListener']('error',r=>{q['error'](r);});if(l)q['error'](l);else{if(k)q['enqueue'](k);}},'cancel'(q){safeCloseWebSocket(f);}});let n={'value':null},o=null,p=![];return m['pipeTo'](new WritableStream({async 'write'(q,r){if(p&&o)return o(q);if(n['value']){const C=n['value']['writable']['getWriter']();await C['write'](q),C['releaseLock']();return;}const {hasError:s,message:t,portRemote:u,addressRemote:v,rawDataIndex:w,vlessVersion:x,isUDP:y,uuid:z}=await parseVlessHeader(q,b);if(s)return r['error'](t),safeCloseWebSocket(f);g=v,h=u+'--'+Math['random']()+'\x20'+(y?'udp':'tcp');const A=await Database['getUser'](b['DB'],z);if(!A){r['error']('Invalid\x20User');return;}if(y){if(u===0x35){p=!![];const D=await handleUDPOutbound(f,new Uint8Array([x[0x0],0x0]),i);o=D['write'],o(q['slice'](w));return;}r['error']('UDP\x20only\x20supported\x20for\x20DNS\x20(53)');return;}const B=Config['fromEnv'](b);await handleTCPOutbound(n,v,u,q['slice'](w),f,new Uint8Array([x[0x0],0x0]),i,B,b,z,c);},'abort'(q){safeCloseWebSocket(f);}}))['catch'](q=>safeCloseWebSocket(f)),new Response(null,{'status':0x65,'webSocket':e});}async function parseVlessHeader(a,b){if(a['byteLength']<0x18)return{'hasError':!![],'message':'invalid\x20data\x20length'};const c=new DataView(a),d=c['getUint8'](0x0),e=stringifyUUID(new Uint8Array(a['slice'](0x1,0x11))),f=c['getUint8'](0x11),g=c['getUint8'](0x12+f),h=g===0x2,i=0x13+f,j=c['getUint16'](i),k=i+0x2,l=c['getUint8'](k);let m=0x0,n=k+0x1,o='';if(l===0x1)m=0x4,o=new Uint8Array(a['slice'](n,n+m))['join']('.');else{if(l===0x2)m=c['getUint8'](n),n++,o=new TextDecoder()['decode'](a['slice'](n,n+m));else{if(l===0x3)m=0x10,o='['+Array['from'](new Uint16Array(a['slice'](n,n+m)))['map'](p=>p['toString'](0x10))['join'](':')+']';else return{'hasError':!![],'message':'invalid\x20addressType:\x20'+l};}}if(!o)return{'hasError':!![],'message':'address\x20is\x20empty'};return{'hasError':![],'addressRemote':o,'addressType':l,'portRemote':j,'rawDataIndex':n+m,'vlessVersion':new Uint8Array([d]),'isUDP':h,'uuid':e};}async function handleTCPOutbound(a,b,c,d,e,f,g,h,i,j,k){const l=connect({'hostname':b,'port':c});a['value']=l;const m=l['writable']['getWriter']();return await m['write'](d),m['releaseLock'](),l['readable']['pipeTo'](new WritableStream({async 'write'(n,o){if(j&&i&&i['DB']&&k)k['waitUntil'](Database['updateUserTraffic'](i['DB'],j,n['byteLength']));e['readyState']===0x1&&(f?(e['send'](await new Blob([f,n])['arrayBuffer']()),f=null):e['send'](n));}}))['catch'](n=>safeCloseWebSocket(e)),l;}async function handleUDPOutbound(a,b,c){let d=![];const e=new TransformStream({'transform'(g,h){for(let i=0x0;i<g['byteLength'];){const j=g['slice'](i,i+0x2),k=g[i]<<0x8|g[i+0x1],l=new Uint8Array(g['slice'](i+0x2,i+0x2+k));i=i+0x2+k,h['enqueue'](l);}}});e['readable']['pipeTo'](new WritableStream({async 'write'(g){const h=await fetch('https://1.1.1.1/dns-query',{'method':'POST','headers':{'content-type':'application/dns-message'},'body':g}),i=await h['arrayBuffer'](),j=i['byteLength'],k=new Uint8Array([j>>0x8&0xff,j&0xff]);if(a['readyState']===0x1){if(d)a['send'](await new Blob([k,i])['arrayBuffer']());else a['send'](await new Blob([b,k,i])['arrayBuffer']()),d=!![];}}}))['catch'](g=>c('dns\x20pipeTo\x20error',g));const f=e['writable']['getWriter']();return{'write':g=>f['write'](g)};}function stringifyUUID(a){return[...a]['map']((c,d)=>(c<0x10?'0':'')+c['toString'](0x10)+([0x3,0x5,0x7,0x9]['includes'](d)?'-':''))['join']('');}function base64ToArrayBuffer(a){if(!a)return{'earlyData':null,'error':null};try{return{'earlyData':Uint8Array['from'](atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),b=>b['charCodeAt'](0x0))['buffer'],'error':null};}catch(b){return{'earlyData':null,'error':b};}}function safeCloseWebSocket(a){try{if(a['readyState']===0x1||a['readyState']===0x0)a['close']();}catch(b){}}const Subscriptions={'toClash'(a,b){return'port:\x207890\x0asocks-port:\x207891\x0aredir-port:\x207892\x0amixed-port:\x207893\x0amode:\x20rule\x0alog-level:\x20info\x0aproxies:\x0a\x20\x20-\x20name:\x20'+b+'\x0a\x20\x20\x20\x20server:\x20'+b+'\x0a\x20\x20\x20\x20port:\x20443\x0a\x20\x20\x20\x20type:\x20vless\x0a\x20\x20\x20\x20uuid:\x20'+a['uuid']+'\x0a\x20\x20\x20\x20cipher:\x20auto\x0a\x20\x20\x20\x20tls:\x20true\x0a\x20\x20\x20\x20udp:\x20true\x0a\x20\x20\x20\x20skip-cert-verify:\x20true\x0a\x20\x20\x20\x20network:\x20ws\x0a\x20\x20\x20\x20ws-opts:\x0a\x20\x20\x20\x20\x20\x20path:\x20/\x0a\x20\x20\x20\x20\x20\x20headers:\x0a\x20\x20\x20\x20\x20\x20\x20\x20Host:\x20'+b+'\x0aproxy-groups:\x0a\x20\x20-\x20name:\x20PROXY\x0a\x20\x20\x20\x20type:\x20select\x0a\x20\x20\x20\x20proxies:\x0a\x20\x20\x20\x20\x20\x20-\x20'+b+'\x0a\x20\x20\x20\x20\x20\x20-\x20DIRECT\x0arules:\x0a\x20\x20-\x20MATCH,PROXY';},'toSingbox'(a,b){return JSON['stringify']({'log':{'level':'info','timestamp':!![]},'inbounds':[{'type':'tun','tag':'tun-in','inet4_address':'172.19.0.1/30','auto_route':!![],'strict_route':!![]}],'outbounds':[{'type':'vless','tag':'proxy','server':b,'server_port':0x1bb,'uuid':a['uuid'],'flow':'','tls':{'enabled':!![],'server_name':b,'insecure':!![]},'transport':{'type':'ws','path':'/','headers':{'Host':b}}},{'type':'direct','tag':'direct'}],'route':{'rules':[{'outbound':'direct','ip_cidr':['geoip:private']},{'outbound':'proxy','port':[0x50,0x1bb]}]}},null,0x2);}};export default{async 'fetch'(a,b,c){try{const d=Config['fromEnv'](b);await Database['init'](b);const f=new URL(a['url']);if(a['headers']['get']('Upgrade')==='websocket')return await vlessOverWSHandler(a,b,c);if(f['pathname']==='/robots.txt')return new Response('User-agent:\x20*\x0aDisallow:\x20/admin',{'status':0xc8});if(f['pathname']['startsWith']('/'+d['adminPath'])){if(a['method']==='POST'&&f['pathname']==='/'+d['adminPath']){const h=await a['formData']();if(h['get']('password')===d['adminKey'])return new Response(null,{'status':0x12e,'headers':{'Set-Cookie':'auth_token='+d['adminKey']+';\x20Path=/;\x20HttpOnly;\x20Secure;\x20SameSite=Strict','Location':'/'+d['adminPath']}});return new Response(buildLoginPage(d['adminPath'],'Invalid\x20Credentials'),{'headers':{'Content-Type':'text/html'}});}if((a['headers']['get']('Cookie')||'')['indexOf']('auth_token='+d['adminKey'])===-0x1)return new Response(buildLoginPage(d['adminPath']),{'headers':{'Content-Type':'text/html'}});if(f['searchParams']['get']('action'))return await handleApiRequest(a,b);const g=Utils['generateNonce']();return new Response(buildAdminUI(d,g),{'headers':{'Content-Type':'text/html','Content-Security-Policy':'default-src\x20\x27self\x27;\x20script-src\x20\x27self\x27\x20\x27nonce-'+g+'\x27\x20https://cdnjs.cloudflare.com;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27;\x20img-src\x20\x27self\x27\x20data:;\x20connect-src\x20\x27self\x27;'}});}if(f['pathname']['startsWith']('/sub/')){const i=f['pathname']['split']('/')[0x2],j=await Database['getUser'](b['DB'],i);if(j){c['waitUntil'](b['DB']['prepare']('UPDATE\x20users\x20SET\x20active\x20=\x201\x20WHERE\x20uuid\x20=\x20?')['bind'](i)['run']());const k=f['searchParams']['get']('format');if(k==='clash')return new Response(Subscriptions['toClash'](j,f['hostname']),{'headers':{'Content-Type':'text/yaml','Content-Disposition':'attachment;\x20filename=\x22'+f['hostname']+'.yaml\x22'}});if(k==='singbox')return new Response(Subscriptions['toSingbox'](j,f['hostname']),{'headers':{'Content-Type':'application/json','Content-Disposition':'attachment;\x20filename=\x22'+f['hostname']+'.json\x22'}});return new Response(buildUserUI(j,d),{'headers':{'Content-Type':'text/html'}});}return new Response('Invalid\x20Subscription',{'status':0x194});}if(d['enableLandingProxy'])try{const l=new URL(d['landingPageUrl']),m=new Request(l['origin']+f['pathname']+f['search'],{'method':a['method'],'headers':a['headers'],'body':a['body'],'redirect':'follow'});m['headers']['set']('Host',l['hostname']),m['headers']['set']('Referer',l['origin']);const n=await fetch(m),o=new Headers(n['headers']);return o['delete']('Content-Security-Policy'),o['delete']('X-Frame-Options'),Utils['addSecurityHeaders'](o),new Response(n['body'],{'status':n['status'],'headers':o});}catch(p){}return new Response('<!DOCTYPE\x20html><html><body\x20style=\x22background:#0f172a;color:#fff;display:flex;justify-content:center;align-items:center;height:100vh;font-family:sans-serif\x22><h1>404\x20Not\x20Found</h1></body></html>',{'status':0x194,'headers':{'Content-Type':'text/html'}});}catch(q){return new Response('Error:\x20'+q['message']+'\x0a'+q['stack'],{'status':0x1f4});}},async 'scheduled'(a,b,c){await Database['init'](b);const d=Config['fromEnv'](b);for(const f of d['proxyIPs']){try{const g=Date['now'](),h=await fetch('https://'+f,{'method':'HEAD'});await Database['saveProxyHealth'](b['DB'],f,Date['now']()-g,h['ok']||h['status']===0x194);}catch(i){await Database['saveProxyHealth'](b['DB'],f,0x0,![]);}}b['DB']&&await b['DB']['prepare']('UPDATE\x20users\x20SET\x20active\x20=\x200\x20WHERE\x20active\x20=\x201\x20AND\x20expiration_date\x20IS\x20NOT\x20NULL\x20AND\x20datetime(expiration_date\x20||\x20\x27\x20\x27\x20||\x20COALESCE(expiration_time,\x20\x2700:00:00\x27))\x20<\x20datetime(\x27now\x27)')['run']();}};